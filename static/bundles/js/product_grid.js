document.addEventListener("DOMContentLoaded",(function(){var t=document.querySelector(".product-grid"),e=document.querySelectorAll(".filter-btn"),o=document.getElementById("sort-options");function r(t){var e=null;if(document.cookie&&""!==document.cookie)for(var o=document.cookie.split(";"),r=0;r<o.length;r++){var n=o[r].trim();if(n.substring(0,t.length+1)===t+"="){e=decodeURIComponent(n.substring(t.length+1));break}}return e}function n(t,e){var o=document.querySelector(".messages-container");o||((o=document.createElement("div")).className="messages-container position-fixed top-0 end-0 p-3",o.style.zIndex="1050",document.body.appendChild(o));var r=document.createElement("div");r.className="alert alert-".concat(e," alert-dismissible fade show"),r.role="alert",r.innerHTML="\n            ".concat(t,'\n            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>\n        '),o.appendChild(r),setTimeout((function(){r.classList.remove("show"),setTimeout((function(){r.remove()}),150)}),5e3)}"undefined"!=typeof bootstrap&&bootstrap.Tooltip&&[].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]')).map((function(t){return new bootstrap.Tooltip(t)})),t&&(document.querySelectorAll(".wishlist-btn").forEach((function(t){t.addEventListener("click",(function(t){t.preventDefault();var e=this.getAttribute("data-product-id"),o=this.querySelector("i");o.classList.contains("fa-heart-o")?(o.classList.replace("fa-heart-o","fa-heart"),this.classList.add("active"),function(t){var e=r("csrftoken");fetch("/wishlist/add/",{method:"POST",headers:{"Content-Type":"application/json","X-CSRFToken":e},body:JSON.stringify({product_id:t})}).then((function(t){if(!t.ok)throw new Error("Network response was not ok");return t.json()})).then((function(t){t.success?n("Product added to wishlist","success"):t.login_required?window.location.href="/accounts/login/?next="+window.location.pathname:n(t.message||"Error adding to wishlist","danger")})).catch((function(t){console.error("Error:",t),n("Error adding to wishlist","danger")}))}(e)):(o.classList.replace("fa-heart","fa-heart-o"),this.classList.remove("active"),function(t){var e=r("csrftoken");fetch("/wishlist/remove/",{method:"POST",headers:{"Content-Type":"application/json","X-CSRFToken":e},body:JSON.stringify({product_id:t})}).then((function(t){if(!t.ok)throw new Error("Network response was not ok");return t.json()})).then((function(t){t.success?n("Product removed from wishlist","success"):n(t.message||"Error removing from wishlist","danger")})).catch((function(t){console.error("Error:",t),n("Error removing from wishlist","danger")}))}(e))}))})),e.length&&e.forEach((function(o){o.addEventListener("click",(function(){e.forEach((function(t){return t.classList.remove("active")})),this.classList.add("active");var o=this.getAttribute("data-filter");document.querySelectorAll(".product-item").forEach((function(t){"all"===o?t.style.display="block":"new"===o?t.style.display="true"===t.getAttribute("data-is-new")?"block":"none":"low-stock"===o&&(t.style.display="true"===t.getAttribute("data-is-low-stock")?"block":"none")})),function(){var e=document.querySelectorAll(".product-item"),o=0;e.forEach((function(t){"none"!==t.style.display&&o++}));var r=document.querySelector(".no-products");0===o?(r||((r=document.createElement("div")).className="no-products",r.innerHTML="<p>No products match your filter criteria.</p>",t.appendChild(r)),r.style.display="block"):r&&(r.style.display="none")}()}))})),o&&o.addEventListener("change",(function(){var t=this.value,e=Array.from(document.querySelectorAll(".product-item"));if(0!==e.length){e.sort((function(e,o){return"price-low"===t?parseFloat(e.getAttribute("data-price"))-parseFloat(o.getAttribute("data-price")):"price-high"===t?parseFloat(o.getAttribute("data-price"))-parseFloat(e.getAttribute("data-price")):"name-az"===t?e.getAttribute("data-name").localeCompare(o.getAttribute("data-name")):"name-za"===t?o.getAttribute("data-name").localeCompare(e.getAttribute("data-name")):0}));var o=e[0].parentNode;e.forEach((function(t){return o.appendChild(t)}))}})),document.querySelectorAll(".add-to-cart-btn").forEach((function(t){t.addEventListener("click",(function(){var t=this;if(!this.disabled){var e=this.getAttribute("data-product-id"),o=r("csrftoken"),a=this.innerHTML;this.innerHTML='<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span> Adding...',this.disabled=!0,fetch("/cart/add/",{method:"POST",headers:{"Content-Type":"application/json","X-CSRFToken":o},body:JSON.stringify({product_id:e,quantity:1})}).then((function(t){if(!t.ok)throw new Error("Network response was not ok");return t.json()})).then((function(e){if(t.innerHTML=a,t.disabled=!1,e.success){n("Product added to cart","success");var o=document.querySelector(".cart-count");o&&e.cart_count&&(o.textContent=e.cart_count)}else n(e.message||"Error adding to cart","danger")})).catch((function(e){t.innerHTML=a,t.disabled=!1,console.error("Error:",e),n("Error adding to cart","danger")}))}}))})))}));