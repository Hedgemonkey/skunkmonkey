(()=>{"use strict";var t={6443:(t,e,i)=>{function o(t){var e=null;if(document.cookie&&""!==document.cookie)for(var i=document.cookie.split(";"),o=0;o<i.length;o++){var s=i[o].trim();if(s.substring(0,t.length+1)===t+"="){e=decodeURIComponent(s.substring(t.length+1));break}}return e}function s(t){return s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},s(t)}function n(t,e){for(var i=0;i<e.length;i++){var o=e[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,r(o.key),o)}}function r(t){var e=function(t){if("object"!=s(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,"string");if("object"!=s(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==s(e)?e:e+""}i.d(e,{A:()=>h});const a=new(function(){return t=function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.errorHandler=e.errorHandler||console.error,this.baseUrl=e.baseUrl||"",this.csrfToken=o("csrftoken"),this.pendingRequests=[]},e=[{key:"buildUrl",value:function(t){return t.startsWith("http")||t.startsWith("/")?t:"".concat(this.baseUrl,"/").concat(t).replace(/([^:]\/)\/+/g,"$1")}},{key:"get",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return this.request("GET",t,e,i)}},{key:"post",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return this.request("POST",t,e,i)}},{key:"delete",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return this.request("DELETE",t,e,i)}},{key:"request",value:function(t,e){var i=this,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},r=this.buildUrl(e),a=!1!==n.abortable,l=!(s instanceof FormData),u=!!l&&"application/x-www-form-urlencoded; charset=UTF-8";return new Promise((function(e,c){try{var d=function(t,e,i,s,n){var r=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],a=!(arguments.length>6&&void 0!==arguments[6])||arguments[6],l=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"application/x-www-form-urlencoded; charset=UTF-8";i instanceof FormData&&(a=!1,l=!1);var u={url:t,method:e,data:i,processData:a,contentType:l,headers:{"X-CSRFToken":o("csrftoken"),"X-Requested-With":"XMLHttpRequest"},success:function(t){"function"==typeof s&&("string"==typeof t&&t.trim().startsWith("<")?s({html:t}):s(t))},error:function(t,e,i){"abort"!==e&&(console.error("AJAX Request failed:",e,i),"function"==typeof n&&n(t,e,i))}};(t.includes("/api/")||t.endsWith(".json"))&&(u.dataType="json");var c=$.ajax(u);if(r)return c}(r,t,s,(function(t){i.removePendingRequest(d),e(t)}),(function(t,e,o){var s;i.removePendingRequest(d);var r={status:t.status,statusText:t.statusText,responseJSON:t.responseJSON,message:(null===(s=t.responseJSON)||void 0===s?void 0:s.error)||o||"Request failed"};i.errorHandler&&!n.skipGlobalErrorHandler&&i.errorHandler(r),c(r)}),a,l,u);a&&d&&i.pendingRequests.push(d),n.timeout&&setTimeout((function(){d&&d.readyState<4&&(d.abort(),c({message:"Request timed out",status:0,statusText:"timeout"}))}),n.timeout)}catch(t){console.error("Error making request:",t),c({message:t.message||"Failed to make request",error:t})}}))}},{key:"removePendingRequest",value:function(t){var e=this.pendingRequests.indexOf(t);-1!==e&&this.pendingRequests.splice(e,1)}},{key:"abortAll",value:function(){this.pendingRequests.forEach((function(t){t&&"function"==typeof t.abort&&t.abort()})),this.pendingRequests=[]}}],e&&n(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e}());function l(t){return l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},l(t)}function u(t,e){for(var i=0;i<e.length;i++){var o=e[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,c(o.key),o)}}function c(t){var e=function(t){if("object"!=l(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,"string");if("object"!=l(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==l(e)?e:e+""}var d=function(){return t=function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.initialize(),this.toastQueue=[],this.processingToast=!1,this.debug=!0},e=[{key:"initialize",value:function(){var t=this;try{this.initEventListeners(),this.checkSweetAlert2Availability(),document.addEventListener("swal2-initialized",(function(){t.log("SweetAlert2 initialized event received, processing queued toasts"),t.processToastQueue()}))}catch(t){console.error("Error initializing Wishlist Manager:",t)}}},{key:"log",value:function(){if(this.debug){for(var t,e=arguments.length,i=new Array(e),o=0;o<e;o++)i[o]=arguments[o];(t=console).log.apply(t,["[WishlistManager]"].concat(i))}}},{key:"checkSweetAlert2Availability",value:function(){var t=this;void 0!==window.Swal?(this.log("SweetAlert2 is available for WishlistManager."),document.dispatchEvent(new Event("swal2-initialized"))):(console.warn("SweetAlert2 is not available for WishlistManager. Toast notifications will fall back to alerts."),window.addEventListener("load",(function(){setTimeout((function(){void 0!==window.Swal&&(t.log("SweetAlert2 became available after window load"),document.dispatchEvent(new Event("swal2-initialized")))}),500)})))}},{key:"initEventListeners",value:function(){var t=this;document.addEventListener("click",(function(e){var i=e.target.closest(".add-to-wishlist-btn");i&&!i.hasAttribute("data-event-bound")&&(i.setAttribute("data-event-bound","true"),i.addEventListener("click",(function(e){e.preventDefault(),t.handleAddToWishlist(e)})))})),document.addEventListener("click",(function(e){var i=e.target.closest(".remove-wishlist-btn");i&&!i.hasAttribute("data-event-bound")&&(i.setAttribute("data-event-bound","true"),i.addEventListener("click",(function(e){e.preventDefault(),t.handleRemoveFromWishlist(e)})))})),this.log("Wishlist event listeners initialized")}},{key:"handleAddToWishlist",value:function(t){var e=this,i=t.currentTarget,o=i.getAttribute("href"),s=i.dataset.productId,n=i.dataset.productName||"Product";this.log("Adding product to wishlist:",s,n),i.classList.add("wishlist-btn-active");var r=i.innerHTML;i.innerHTML='<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>',i.classList.add("disabled"),a.get(o).then((function(t){e.log("Wishlist add response:",t),i.innerHTML=r,i.classList.remove("disabled"),i.classList.remove("wishlist-btn-active"),t.success?(e.updateWishlistButtonState(i,!0),e.showToast("Added to Wishlist",t.message||"".concat(n," added to your wishlist."),"success"),e.updateWishlistCount(t.wishlist_count)):e.showToast("Error",t.error||"Failed to add product to wishlist.","error")})).catch((function(t){console.error("Error adding to wishlist:",t),i.innerHTML=r,i.classList.remove("disabled"),i.classList.remove("wishlist-btn-active"),e.showToast("Error","Failed to add product to wishlist.","error")}))}},{key:"handleRemoveFromWishlist",value:function(t){var e=this,i=t.currentTarget,o=i.getAttribute("href"),s=i.dataset.productId,n=i.dataset.productName||"Product";this.log("Removing product from wishlist:",s,n),void 0!==window.Swal?window.Swal.fire({title:"Remove from Wishlist",text:"Are you sure you want to remove this item from your wishlist?",icon:"question",showCancelButton:!0,confirmButtonColor:"#dc3545",cancelButtonColor:"#6c757d",confirmButtonText:"Yes, remove it",cancelButtonText:"No, keep it"}).then((function(t){t.isConfirmed&&e.performWishlistRemoval(i,o,s,n)})):confirm("Are you sure you want to remove this item from your wishlist?")&&this.performWishlistRemoval(i,o,s,n)}},{key:"performWishlistRemoval",value:function(t,e,i,o){var s=this;t.classList.add("wishlist-btn-active");var n=t.innerHTML;t.innerHTML='<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>',t.classList.add("disabled"),a.get(e).then((function(e){s.log("Wishlist remove response:",e),t.innerHTML=n,t.classList.remove("disabled"),t.classList.remove("wishlist-btn-active"),e.success?window.location.pathname.includes("/wishlist/")?window.location.reload():(s.updateWishlistButtonState(t,!1),s.showToast("Removed from Wishlist",e.message||"".concat(o," removed from your wishlist."),"info"),s.updateWishlistCount(e.wishlist_count)):s.showToast("Error",e.error||"Failed to remove product from wishlist.","error")})).catch((function(e){console.error("Error removing from wishlist:",e),t.innerHTML=n,t.classList.remove("disabled"),t.classList.remove("wishlist-btn-active"),s.showToast("Error","Failed to remove product from wishlist.","error")}))}},{key:"updateWishlistButtonState",value:function(t,e){if(this.log("Updating wishlist button state:",e?"in wishlist":"not in wishlist"),e){var i;t.classList.remove("add-to-wishlist-btn"),t.classList.add("remove-wishlist-btn"),null===(i=t.querySelector("i"))||void 0===i||i.classList.replace("far","fas"),t.setAttribute("title","Remove from wishlist"),t.setAttribute("aria-label","Remove ".concat(t.dataset.productName||"this product"," from wishlist"));var o=t.getAttribute("href").replace("add_to_wishlist","remove_from_wishlist");t.setAttribute("href",o)}else{var s;t.classList.remove("remove-wishlist-btn"),t.classList.add("add-to-wishlist-btn"),null===(s=t.querySelector("i"))||void 0===s||s.classList.replace("fas","far"),t.setAttribute("title","Add to wishlist"),t.setAttribute("aria-label","Add ".concat(t.dataset.productName||"this product"," to wishlist"));var n=t.getAttribute("href").replace("remove_from_wishlist","add_to_wishlist");t.setAttribute("href",n)}t.removeAttribute("data-event-bound"),this.initEventListeners()}},{key:"updateWishlistCount",value:function(t){void 0!==t&&(this.log("Updating wishlist count:",t),document.querySelectorAll(".wishlist-count").forEach((function(e){e.textContent=t})))}},{key:"showToast",value:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"info";this.log("Queueing toast notification:",t,e,i),this.toastQueue.push({title:t,message:e,type:i}),this.processingToast||this.processToastQueue()}},{key:"processToastQueue",value:function(){var t=this;if(0!==this.toastQueue.length){this.processingToast=!0;var e=this.toastQueue.shift(),i=e.title,o=e.message,s=e.type;this.displayToast(i,o,s).then((function(){setTimeout((function(){t.processToastQueue()}),300)})).catch((function(e){console.error("Error displaying toast:",e),setTimeout((function(){t.processToastQueue()}),300)}))}else this.processingToast=!1}},{key:"displayToast",value:function(t,e,i){var o=this;return new Promise((function(s,n){if(o.log("Attempting to display toast:",t,e,i),"function"==typeof window.showToast)o.log("Using global showToast function"),window.showToast(t,e,i),s();else if(void 0!==window.Swal){o.log("Using SweetAlert2 directly");var r="danger"===i?"error":i;window.Swal.fire({title:t,text:e,icon:r,toast:!0,position:"top-end",showConfirmButton:!1,timer:3e3,timerProgressBar:!0,didOpen:function(t){t.style.zIndex="9999",t.style.opacity="1",t.style.visibility="visible",o.log("Toast opened:",t),t.addEventListener("mouseenter",window.Swal.stopTimer),t.addEventListener("mouseleave",window.Swal.resumeTimer)}}).then(s).catch(n)}else{o.log("SweetAlert2 not available, waiting...");var a=setTimeout((function(){console.warn("Timed out waiting for SweetAlert2, using fallback"),alert("".concat(t,": ").concat(e)),s()}),2e3);document.addEventListener("swal2-initialized",(function(){if(clearTimeout(a),o.log("SweetAlert2 became available, displaying toast"),void 0!==window.Swal){var r="danger"===i?"error":i;window.Swal.fire({title:t,text:e,icon:r,toast:!0,position:"top-end",showConfirmButton:!1,timer:3e3,timerProgressBar:!0,didOpen:function(t){t.style.zIndex="9999",t.style.opacity="1",t.style.visibility="visible",t.addEventListener("mouseenter",window.Swal.stopTimer),t.addEventListener("mouseleave",window.Swal.resumeTimer)}}).then(s).catch(n)}else alert("".concat(t,": ").concat(e)),s()}),{once:!0})}}))}}],e&&u(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e}();document.addEventListener("DOMContentLoaded",(function(){console.log("WishlistManager script loaded"),window.wishlistManager=new d}));const h=d}},e={};function i(o){var s=e[o];if(void 0!==s)return s.exports;var n=e[o]={exports:{}};return t[o](n,n.exports,i),n.exports}i.d=(t,e)=>{for(var o in e)i.o(e,o)&&!i.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:e[o]})},i.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e);var o,s=i(6443);console.log("Initializing wishlist functionality"),document.addEventListener("DOMContentLoaded",(function(){o=new s.A,window.wishlistManager=o}))})();