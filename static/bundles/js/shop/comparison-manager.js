(()=>{"use strict";function e(e){var t=null;if(document.cookie&&""!==document.cookie)for(var o=document.cookie.split(";"),r=0;r<o.length;r++){var n=o[r].trim();if(n.substring(0,e.length+1)===e+"="){t=decodeURIComponent(n.substring(e.length+1));break}}return t}function t(e){return t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},t(e)}function o(e,t){for(var o=0;o<t.length;o++){var n=t[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,r(n.key),n)}}function r(e){var o=function(e){if("object"!=t(e)||!e)return e;var o=e[Symbol.toPrimitive];if(void 0!==o){var r=o.call(e,"string");if("object"!=t(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==t(o)?o:o+""}const n=new(function(){return t=function t(){var o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),this.errorHandler=o.errorHandler||console.error,this.baseUrl=o.baseUrl||"",this.csrfToken=e("csrftoken"),this.pendingRequests=[]},r=[{key:"buildUrl",value:function(e){return e.startsWith("http")||e.startsWith("/")?e:"".concat(this.baseUrl,"/").concat(e).replace(/([^:]\/)\/+/g,"$1")}},{key:"get",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return this.request("GET",e,t,o)}},{key:"post",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return this.request("POST",e,t,o)}},{key:"delete",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return this.request("DELETE",e,t,o)}},{key:"request",value:function(t,o){var r=this,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},a=this.buildUrl(o),s=!1!==i.abortable,c=!(n instanceof FormData),u=!!c&&"application/x-www-form-urlencoded; charset=UTF-8";return new Promise((function(o,l){try{var d=function(t,o,r,n,i){var a=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],s=!(arguments.length>6&&void 0!==arguments[6])||arguments[6],c=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"application/x-www-form-urlencoded; charset=UTF-8";r instanceof FormData&&(s=!1,c=!1);var u={url:t,method:o,data:r,processData:s,contentType:c,headers:{"X-CSRFToken":e("csrftoken"),"X-Requested-With":"XMLHttpRequest"},success:function(e){"function"==typeof n&&("string"==typeof e&&e.trim().startsWith("<")?n({html:e}):n(e))},error:function(e,t,o){"abort"!==t&&(console.error("AJAX Request failed:",t,o),"function"==typeof i&&i(e,t,o))}};(t.includes("/api/")||t.endsWith(".json"))&&(u.dataType="json");var l=$.ajax(u);if(a)return l}(a,t,n,(function(e){r.removePendingRequest(d),o(e)}),(function(e,t,o){var n;r.removePendingRequest(d);var a={status:e.status,statusText:e.statusText,responseJSON:e.responseJSON,message:(null===(n=e.responseJSON)||void 0===n?void 0:n.error)||o||"Request failed"};r.errorHandler&&!i.skipGlobalErrorHandler&&r.errorHandler(a),l(a)}),s,c,u);s&&d&&r.pendingRequests.push(d),i.timeout&&setTimeout((function(){d&&d.readyState<4&&(d.abort(),l({message:"Request timed out",status:0,statusText:"timeout"}))}),i.timeout)}catch(e){console.error("Error making request:",e),l({message:e.message||"Failed to make request",error:e})}}))}},{key:"removePendingRequest",value:function(e){var t=this.pendingRequests.indexOf(e);-1!==t&&this.pendingRequests.splice(t,1)}},{key:"abortAll",value:function(){this.pendingRequests.forEach((function(e){e&&"function"==typeof e.abort&&e.abort()})),this.pendingRequests=[]}}],r&&o(t.prototype,r),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,r}());function i(e){return i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i(e)}function a(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,s(r.key),r)}}function s(e){var t=function(e){if("object"!=i(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var o=t.call(e,"string");if("object"!=i(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==i(t)?t:t+""}var c=function(){return e=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.initialize()},t=[{key:"initialize",value:function(){try{this.bindEvents(),this.updateComparisonCount()}catch(e){console.error("Error initializing Comparison Manager:",e)}}},{key:"bindEvents",value:function(){var e=this;document.addEventListener("click",(function(t){var o=t.target.closest(".add-to-comparison-btn");o&&(t.preventDefault(),e.handleAddToComparison(o))})),document.addEventListener("click",(function(t){var o=t.target.closest(".remove-from-comparison");o&&(t.preventDefault(),e.handleRemoveFromComparison(o))}))}},{key:"handleAddToComparison",value:function(e){var t=this,o=(e.dataset.productId,e.dataset.productName||"Product"),r=e.href,i=e.classList.contains("btn-success");this.updateButtonState(e,!i),n.get(r).then((function(r){r.success?(i?t.showToast("Removed from Comparison",r.message||"".concat(o," removed from comparison list."),"info"):t.showToast("Added to Comparison",r.message||"".concat(o," added to comparison list."),"success"),t.updateComparisonCount(r.comparison_count)):(t.updateButtonState(e,i),t.showToast("Notice",r.message||"Failed to update comparison list","warning"))})).catch((function(o){t.updateButtonState(e,i),console.error("Error updating comparison:",o),t.showToast("Error","Failed to update comparison list","error")}))}},{key:"updateButtonState",value:function(e,t){if(t){e.classList.remove("btn-outline-secondary"),e.classList.add("btn-success"),e.innerHTML='<i class="fas fa-check me-1"></i> Compared',e.setAttribute("title","Remove from comparison");var o=e.getAttribute("href").replace("add_to_comparison","remove_from_comparison");e.setAttribute("href",o)}else{e.classList.remove("btn-success"),e.classList.add("btn-outline-secondary"),e.innerHTML='<i class="fas fa-balance-scale me-1"></i> Compare',e.setAttribute("title","Add to comparison");var r=e.getAttribute("href").replace("remove_from_comparison","add_to_comparison");e.setAttribute("href",r)}}},{key:"handleRemoveFromComparison",value:function(e){var t=this,o=e.href,r=e.dataset.productName||"Product";n.get(o).then((function(e){e.success?window.location.pathname.includes("/comparison/")?window.location.reload():(t.updateComparisonCount(e.comparison_count),t.showToast("Removed from Comparison",e.message||"".concat(r," removed from comparison list."),"info")):t.showToast("Error",e.message||"Failed to remove product","error")})).catch((function(e){console.error("Error removing from comparison:",e),t.showToast("Error","Failed to remove product from comparison","error")}))}},{key:"updateComparisonCount",value:function(e){var t=document.querySelectorAll(".comparison-count");t.length>0&&void 0!==e&&t.forEach((function(t){t.textContent=e}))}},{key:"showToast",value:function(e,t){var o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"info",r="danger"===o?"error":o;void 0!==window.Swal?(console.log("Showing toast with SweetAlert2:",e,t,r),window.Swal.fire({title:e,text:t,icon:r,toast:!0,position:"top-end",showConfirmButton:!1,timer:3e3,timerProgressBar:!0,didOpen:function(e){e.addEventListener("mouseenter",window.Swal.stopTimer),e.addEventListener("mouseleave",window.Swal.resumeTimer)}})):(console.warn("SweetAlert2 not available for toast:",e,t),alert("".concat(e,": ").concat(t)))}}],t&&a(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t}();document.addEventListener("DOMContentLoaded",(function(){void 0===window.Swal?console.warn("SweetAlert2 is not available. Toast notifications will fall back to alerts."):console.log("SweetAlert2 is available for ComparisonManager."),window.comparisonManager=new c}))})();