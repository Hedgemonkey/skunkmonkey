(()=>{function t(e){return t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},t(e)}function e(t,e){for(var i=0;i<e.length;i++){var o=e[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,r(o.key),o)}}function r(e){var r=function(e){if("object"!=t(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var i=r.call(e,"string");if("object"!=t(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==t(r)?r:r+""}var i=function(){return t=function t(){var e=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t);try{this.initializeProductGridFeatures(),this.filterContainer=document.getElementById("dynamic-filter-container"),this.filterContainer||console.warn("Product List Manager: dynamic-filter-container not found in the DOM"),this.filterContainer&&(this.productListUrl=this.filterContainer.dataset.productListUrl,this.productListUrl||(console.warn("Product List Manager: No product list URL provided in data-product-list-url attribute"),this.productListUrl=window.location.href),this.filterState={search:(this.filterContainer.dataset.searchQuery||"").trim(),category:(this.filterContainer.dataset.currentCategory||"").trim(),sort:"name-asc"},this.initializeFilterDomReferences(),this.hasEssentialFilterElements()&&(this.initializeFilterControls(),this.bindFilterEvents(),this.updateFilterUI(),setTimeout((function(){e.fetchProducts()}),100)))}catch(t){console.error("Error initializing Product List Manager:",t)}},(r=[{key:"initializeProductGridFeatures",value:function(){var t=this;try{this.positionWishlistButtons(),document.addEventListener("click",(function(e){var r=e.target.closest(".add-to-wishlist-btn");r&&t.handleWishlistButtonClick(e,r)})),window.addEventListener("resize",(function(){t.positionWishlistButtons()})),document.addEventListener("productsLoaded",(function(){t.positionWishlistButtons()}))}catch(t){console.error("Error initializing product grid features:",t)}}},{key:"initializeFilterDomReferences",value:function(){this.productGridContainer=document.getElementById("product-grid-container"),this.searchInput=document.querySelector(".filter-search"),this.sortSelect=document.querySelector(".filter-sort"),this.categorySelect=document.querySelector(".filter-category"),this.clearSearchBtn=document.querySelector(".clear-search"),this.resetAllBtn=document.querySelector(".reset-all-filters"),this.filterToggleBtn=document.querySelector(".filter-toggle"),this.filterOptions=document.getElementById("filterOptions"),this.searchDisplay=document.querySelector(".search-display"),this.searchTerm=document.querySelector(".search-term"),this.searchTermSummary=document.querySelector(".search-term-summary"),this.searchSummary=document.querySelector(".search-summary"),this.categoriesDisplay=document.querySelector(".categories-display"),this.categoryCountDisplay=document.querySelector(".category-count-display"),this.categoriesSummary=document.querySelector(".categories-summary"),this.categoryCountSummary=document.querySelector(".category-count-summary"),this.categoryTagsContainer=document.getElementById("selectedCategoriesTags"),this.clearCategoriesBtn=document.querySelector(".clear-categories-btn"),this.itemCountDisplay=document.querySelector(".item-count"),this.productCountDisplay=document.getElementById("product-count")}},{key:"hasEssentialFilterElements",value:function(){return!!this.productGridContainer||(console.warn("Product List Manager: product-grid-container not found in the DOM"),!1)}},{key:"initializeFilterControls",value:function(){try{var t=new URLSearchParams(window.location.search).get("sort");if(this.sortSelect&&t&&(this.sortSelect.value=t,this.filterState.sort=t),this.categorySelect&&"undefined"!=typeof $&&$.fn&&void 0!==$.fn.select2)try{$(this.categorySelect).select2({placeholder:"Select Categories",allowClear:!0,width:"100%"})}catch(t){console.warn("Error initializing Select2:",t)}}catch(t){console.error("Error initializing controls:",t)}}},{key:"bindFilterEvents",value:function(){var t=this;try{this.searchInput&&this.searchInput.addEventListener("input",this.handleSearchInput.bind(this)),this.sortSelect&&this.sortSelect.addEventListener("change",this.handleSortChange.bind(this)),this.categorySelect&&this.categorySelect.addEventListener("change",this.handleCategoryChange.bind(this)),this.clearSearchBtn&&this.clearSearchBtn.addEventListener("click",this.handleClearSearch.bind(this)),this.clearCategoriesBtn&&this.clearCategoriesBtn.addEventListener("click",this.handleClearCategories.bind(this)),this.resetAllBtn&&this.resetAllBtn.addEventListener("click",this.handleResetAll.bind(this)),this.filterToggleBtn&&this.filterToggleBtn.addEventListener("click",this.handleFilterToggle.bind(this)),document.addEventListener("click",(function(e){try{if(e.target.closest(".search-summary .btn-close")&&t.handleClearSearch(),e.target.closest(".categories-summary .btn-close")&&t.handleClearCategories(),e.target.closest(".tag-remove")){var r=e.target.closest(".tag-remove").dataset.categoryId;r&&t.removeCategoryById(r)}}catch(t){console.error("Error handling click event:",t)}}))}catch(t){console.error("Error binding events:",t)}}},{key:"handleSearchInput",value:function(t){var e=this;try{this.filterState.search=t.target.value,this.updateFilterUI(),clearTimeout(this.searchTimer),this.searchTimer=setTimeout((function(){e.fetchProducts()}),300)}catch(t){console.error("Error handling search input:",t)}}},{key:"handleSortChange",value:function(t){try{this.filterState.sort=t.target.value,this.updateFilterUI(),this.fetchProducts()}catch(t){console.error("Error handling sort change:",t)}}},{key:"handleCategoryChange",value:function(t){try{var e=[];t.target.selectedOptions?e=Array.from(t.target.selectedOptions).map((function(t){return t.value})):t.target.options&&t.target.multiple?e=Array.from(t.target.options).filter((function(t){return t.selected})).map((function(t){return t.value})):t.target.value&&(e=[t.target.value]),this.filterState.category=e.join(","),this.updateFilterUI(),this.fetchProducts()}catch(t){console.error("Error handling category change:",t)}}},{key:"handleClearSearch",value:function(){try{this.filterState.search="",this.searchInput&&(this.searchInput.value=""),this.updateFilterUI(),this.fetchProducts()}catch(t){console.error("Error clearing search:",t)}}},{key:"handleClearCategories",value:function(){try{if(this.filterState.category="",this.categorySelect)if("undefined"!=typeof $&&$.fn&&void 0!==$.fn.select2)try{$(this.categorySelect).val(null).trigger("change")}catch(t){console.warn("Error with Select2 clearing:",t),Array.from(this.categorySelect.options).forEach((function(t){return t.selected=!1}))}else Array.from(this.categorySelect.options).forEach((function(t){return t.selected=!1}));this.updateFilterUI(),this.fetchProducts()}catch(t){console.error("Error clearing categories:",t)}}},{key:"handleResetAll",value:function(){try{if(this.filterState={search:"",category:"",sort:"name-asc"},this.searchInput&&(this.searchInput.value=""),this.sortSelect&&(this.sortSelect.value="name-asc"),this.categorySelect)if("undefined"!=typeof $&&$.fn&&void 0!==$.fn.select2)try{$(this.categorySelect).val(null).trigger("change")}catch(t){console.warn("Error with Select2 resetting:",t),Array.from(this.categorySelect.options).forEach((function(t){return t.selected=!1}))}else Array.from(this.categorySelect.options).forEach((function(t){return t.selected=!1}));this.updateFilterUI(),this.fetchProducts()}catch(t){console.error("Error resetting filters:",t)}}},{key:"handleFilterToggle",value:function(){try{if(!this.filterOptions)return;var t=this.filterOptions.classList.contains("show");if(this.filterOptions.classList.toggle("show"),this.filterToggleBtn){this.filterToggleBtn.classList.toggle("collapsed",!t),this.filterToggleBtn.setAttribute("aria-expanded",t?"false":"true");var e=this.filterToggleBtn.querySelector(".filter-toggle-text");e&&(e.textContent=t?"Show Filters":"Hide Filters")}}catch(t){console.error("Error toggling filter visibility:",t)}}},{key:"removeCategoryById",value:function(t){try{if(!t)return;var e=this.filterState.category.split(",").filter((function(t){return t})).filter((function(e){return e!==t}));if(this.filterState.category=e.join(","),this.categorySelect)if("undefined"!=typeof $&&$.fn&&void 0!==$.fn.select2)try{$(this.categorySelect).val(e).trigger("change")}catch(t){console.warn("Error with Select2 category removal:",t),Array.from(this.categorySelect.options).forEach((function(t){t.selected=e.includes(t.value)}))}else Array.from(this.categorySelect.options).forEach((function(t){t.selected=e.includes(t.value)}));this.updateUI(),this.fetchProducts()}catch(t){console.error("Error removing category:",t)}}},{key:"updateFilterUI",value:function(){try{this.searchTerm&&(this.searchTerm.textContent=this.filterState.search),this.searchTermSummary&&(this.searchTermSummary.textContent=this.filterState.search),this.searchDisplay&&this.searchDisplay.classList.toggle("d-none",!this.filterState.search),this.searchSummary&&this.searchSummary.classList.toggle("d-none",!this.filterState.search);var t=(this.filterState.category?this.filterState.category.split(",").filter((function(t){return t})):[]).length;this.categoryCountDisplay&&(this.categoryCountDisplay.textContent=t),this.categoryCountSummary&&(this.categoryCountSummary.textContent=t),this.categoriesDisplay&&this.categoriesDisplay.classList.toggle("d-none",0===t),this.categoriesSummary&&this.categoriesSummary.classList.toggle("d-none",0===t),this.updateCategoryTags()}catch(t){console.error("Error updating UI:",t)}}},{key:"updateCategoryTags",value:function(){var t=this;try{if(!this.categoryTagsContainer||!this.categorySelect)return;if(this.categoryTagsContainer.innerHTML="",!this.filterState.category)return;var e=this.filterState.category.split(",").filter((function(t){return t}));if(0===e.length)return;e.forEach((function(e){try{var r=Array.from(t.categorySelect.options).find((function(t){return t.value===e}));if(!r)return;var i=r.textContent.trim(),o=document.createElement("div");o.className="category-tag",o.innerHTML='\n                        <span class="tag-text">'.concat(i,'</span>\n                        <button type="button" class="tag-remove" data-category-id="').concat(e,'">\n                            <i class="fas fa-times"></i>\n                        </button>\n                    '),t.categoryTagsContainer.appendChild(o)}catch(t){console.warn("Error creating tag for category ID ".concat(e,":"),t)}}))}catch(t){console.error("Error updating category tags:",t)}}},{key:"isValidUrl",value:function(t){try{return new URL(t),!0}catch(t){return!1}}},{key:"getBaseUrl",value:function(){return this.productListUrl&&this.isValidUrl(this.productListUrl)?this.productListUrl:this.productListUrl&&this.productListUrl.startsWith("/")?new URL(this.productListUrl,window.location.origin).href:window.location.href}},{key:"fetchProducts",value:function(){var t=this;this.productGridContainer&&(this.productGridContainer.classList.add("loading"),this.originalGridHtml=this.productGridContainer.innerHTML);try{var e=this.getBaseUrl(),r=new URL(e);this.filterState.search&&r.searchParams.set("search",this.filterState.search),this.filterState.category&&r.searchParams.set("category",this.filterState.category),this.filterState.sort&&r.searchParams.set("sort",this.filterState.sort),r.searchParams.set("_",Date.now());var i=new AbortController,o=setTimeout((function(){return i.abort()}),15e3);fetch(r,{method:"GET",headers:{"X-Requested-With":"XMLHttpRequest",Accept:"application/json"},signal:i.signal}).then((function(t){if(clearTimeout(o),!t.ok)throw new Error("Server returned ".concat(t.status,": ").concat(t.statusText));var e=t.headers.get("content-type");if(!e||!e.includes("application/json"))throw new Error("Response was not JSON. Received: "+e);return t.json()})).then((function(e){t.productGridContainer&&(e.html?t.productGridContainer.innerHTML=e.html:t.productGridContainer.innerHTML='<div class="alert alert-info">No products found matching your criteria.</div>');var r=e.count||0;t.itemCountDisplay&&(t.itemCountDisplay.textContent=r),t.productCountDisplay&&(t.productCountDisplay.textContent=r),document.dispatchEvent(new CustomEvent("productsLoaded",{detail:e})),t.positionWishlistButtons()})).catch((function(e){console.error("Error fetching products:",e);var r="Error loading products. ";"AbortError"===e.name?r+="Request timed out. Please check your internet connection and try again.":e.message.includes("JSON")?r+="Unexpected response format from server.":r+="Please try again or contact support if the issue persists.",t.productGridContainer&&(t.productGridContainer.innerHTML='<div class="alert alert-danger">'.concat(r,"</div>"))})).finally((function(){t.productGridContainer&&t.productGridContainer.classList.remove("loading")}))}catch(t){console.error("Error constructing request:",t),this.productGridContainer&&(this.productGridContainer.classList.remove("loading"),this.productGridContainer.innerHTML='<div class="alert alert-danger">Configuration error: '.concat(t.message,"</div>"))}}},{key:"handleWishlistButtonClick",value:function(t,e){t.preventDefault(),e.dataset.productId;var r=e.getAttribute("href"),i=e.querySelector("i"),o=i.className;i.className="fas fa-spinner fa-spin",fetch(r,{method:"POST",headers:{"X-CSRFToken":this.getCookie("csrftoken"),"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"},credentials:"same-origin"}).then((function(t){if(!t.ok)throw new Error("Server returned ".concat(t.status,": ").concat(t.statusText));return t.json()})).then((function(t){t.success?t.added?(i.className="fas fa-heart",e.classList.add("active")):(i.className="far fa-heart",e.classList.remove("active")):(i.className=o,console.error("Error updating wishlist:",t.message||"Unknown error"))})).catch((function(t){console.error("Error updating wishlist:",t),i.className=o}))}},{key:"positionWishlistButtons",value:function(){try{document.querySelectorAll(".product-card").forEach((function(t){var e=t.querySelector(".product-badges"),r=t.querySelector(".add-to-wishlist-btn");e&&r&&(e.querySelectorAll(".badge").length>0?(r.style.top="auto",r.style.bottom="10px",r.style.right="10px"):(r.style.top="10px",r.style.bottom="auto",r.style.right="10px"))}))}catch(t){console.error("Error positioning wishlist buttons:",t)}}},{key:"getCookie",value:function(t){var e=null;if(document.cookie&&""!==document.cookie)for(var r=document.cookie.split(";"),i=0;i<r.length;i++){var o=r[i].trim();if(o.substring(0,t.length+1)===t+"="){e=decodeURIComponent(o.substring(t.length+1));break}}return e}}])&&e(t.prototype,r),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,r}();document.addEventListener("DOMContentLoaded",(function(){try{window.productListManager=new i}catch(e){console.error("Fatal error initializing Product List Manager:",e);var t=document.getElementById("product-grid-container");t&&(t.innerHTML='<div class="alert alert-danger">There was an error initializing the product list. Please refresh the page or contact support.</div>')}}))})();