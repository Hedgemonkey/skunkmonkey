import{a as o}from"../common/apiClient.js";import{I as n}from"./filters.js";import{B as g}from"./baseManager.js";import{S as c}from"../chunks/chunks/vendor/common.Dz0GDR6V.js";import"../chunks/ajax_helper.EulIYOr7.js";import"./notifications.js";import"./formUtils.js";import"./categoryFilterManager.js";import"./arrayUtils.js";import"./filterUiManager.js";class b extends g{constructor(t){super({...t,itemType:"category"}),this.filter=null}fetchItems(){o.get(this.urls.getCategoryCards,{},{skipGlobalErrorHandler:!0}).then(t=>{t.html?this.elements.categoryListContainer.html(t.html):this.elements.categoryListContainer.html(t),this.initializeFilters(),this.attachCategoryEventListeners()}).catch(t=>{console.error("Error fetching categories:",t),this.notifications.displayError("Failed to load category cards.")})}delete(t){const e=`${this.urls.categoryBase}${t}/delete/`;return o.post(e,{},{skipGlobalErrorHandler:!0})}showForm(t,e=!1){super.showForm(t,e,{title:e?"Edit Category":"Add New Category",confirmText:e?"Save":"Add Category",successMessage:e?"Category updated successfully.":"Category added successfully."})}add(t=null,e={}){t?this.notifications.prompt({title:"Add New Category",inputPlaceholder:"Enter category name",inputValue:t,preConfirm:a=>o.post(this.urls.addCategory,{name:a},{skipGlobalErrorHandler:!0}).catch(i=>(this.notifications.displaySwalError(i,"Category creation failed."),Promise.reject(i)))}).then(a=>{var i;a.isConfirmed&&(this.fetchItems(),this.notifications.displaySuccess(((i=a.value)==null?void 0:i.message)||"Category added successfully."))}):this.showForm(this.urls.addCategory,!1,e)}handleDelete(t){t.preventDefault();const e=$(t.currentTarget).data("category-name"),a=$(t.currentTarget).data("category-slug");o.get(`/products/staff/category/${a}/products/`,{},{skipGlobalErrorHandler:!0}).then(i=>this.confirmCategoryDeletion(i,a,e)).catch(i=>this.notifications.displaySwalError(i,"Failed to get products for category."))}confirmCategoryDeletion(t,e,a){const i=t.products.length;let s=t.products.map(r=>`${r}<br>`).join("");this.confirmAction({title:`Delete ${a}?`,html:`Are you sure you want to delete this category? This action cannot be undone.<br>
                ${i} product(s) will also be deleted. ${s?"<br>"+s:""}`,input:"checkbox",inputValue:0,inputPlaceholder:"I understand the consequences",inputValidator:r=>!r&&"You need to confirm by checking the box.",preConfirm:()=>(c.showLoading(),this.delete(e).then(r=>(this.notifications.displaySuccess((r==null?void 0:r.message)||`Deleted ${a}`),this.fetchItems(),Promise.resolve())).catch(r=>{var l;return c.hideLoading(),(l=r.responseJSON)!=null&&l.error?this.notifications.displaySwalError(r,r.responseJSON.error):this.notifications.displaySwalError(r,"Failed to delete category. Please try again."),Promise.reject(r)}))})}attachCategoryEventListeners(){$("#category-cards-grid").off("click",".delete-category").on("click",".delete-category",t=>this.handleDelete(t)),$("#category-cards-grid").off("click",".edit-category").on("click",".edit-category",t=>{t.preventDefault(),this.showForm($(t.currentTarget).attr("href"),!0)}),$("#category-cards-grid").off("click",".category-header").on("click",".category-header",t=>{if(!$(t.target).closest("button, a").length){const e=$(t.currentTarget).data("category-id");if(e&&this.filter&&this.filter.categoryManager)return this.filter.categoryManager._toggleCategory(e.toString()),this.filter.categoryManager._updateCategoryCardStyling(),!1}}),$("#category-cards-grid .category-header").css("cursor","pointer")}initializeFilters(){try{console.log("Initializing category filters"),this.filter&&this.filter.destroy(),this.filter=new n({containerId:"category-cards-container",filterUrl:this.urls.getCategoryCards,itemType:"categories",filterOnCategorySelect:!0,onUpdate:()=>{this.attachCategoryEventListeners(),this.filter.categoryManager&&this.filter.categoryManager._updateCategoryCardStyling()}}),this.filter&&typeof this.filter.preloadCategories=="function"&&(this.filter.preloadCategories(),this.filter.categoryManager&&this.filter.categoryManager._updateCategoryCardStyling()),console.log("Category filters initialized successfully")}catch(t){console.error("Error initializing category filters:",t),this.notifications.displayError("Failed to initialize category filters.")}}destroy(){$("#category-cards-grid").off("click",".delete-category"),$("#category-cards-grid").off("click",".edit-category"),$("#category-cards-grid").off("click",".category-header"),this.filter&&(this.filter.destroy(),this.filter=null),super.destroy(),console.log("CategoryManager destroyed")}}export{b as C};
