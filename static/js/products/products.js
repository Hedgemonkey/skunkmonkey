import{$ as e}from"../chunks/chunks/vendor/common.Dz0GDR6V.js";import"../chunks/chunks/vendor/bootstrap.DA4YfA_0.js";import{P as s}from"./productsManager.js";import{C as l}from"./categoryManager.js";import{n}from"./notifications.js";import{a as c}from"../common/apiClient.js";import"../chunks/ajax_helper.EulIYOr7.js";import"./filters.js";import"./formUtils.js";import"./categoryFilterManager.js";import"./arrayUtils.js";import"./filterUiManager.js";import"./baseManager.js";e(function(){({urls:{addProductForm:e("#product-add-button").data("product-add-form-url"),addProduct:e("#product-add-button").data("product-add-url"),productManagement:e("#product-add-button").data("product-management-url"),getProductCards:e("#products-header .accordion-button").data("content-url"),getCategoryCards:e("#category-cards-container").data("category-cards-url"),addCategory:e("#category-add-button").data("category-add-url"),productBase:"/products/staff/product/",categoryBase:"/products/staff/category/"},elements:{addProductButton:e("#product-add-button"),productListContainer:e("#product-cards-container"),addCategoryButton:e("#category-add-button"),categoryList:e("#category-list"),categoryListContainer:e("#category-cards-container"),productCardsContainer:e("#product-cards-container"),managementAccordion:e("#management-accordion")},init:function(){console.log("Initializing product management application"),this.initializeManagers(),this.initializeEventListeners(),this.initializeAccordion(),this.productManager.fetchItems()},initializeManagers:function(){console.log("Initializing managers with URLs:",this.urls);const t={elements:this.elements,urls:this.urls,notifications:n};this.productManager=new s(t),this.categoryManager=new l(t)},initializeEventListeners:function(){console.log("Setting up event listeners"),this.elements.categoryList.on("click",".delete-category",t=>this.categoryManager.handleDelete(t)),e(document).on("click",".edit-category",t=>{t.preventDefault(),this.categoryManager.showForm(e(t.currentTarget).attr("href"),!0)}),e(document).on("click",".edit-product",t=>{t.preventDefault(),this.productManager.showForm(e(t.currentTarget).data("url"),!0)}),this.elements.addProductButton.on("click",()=>{console.log("Add Product button clicked"),this.handleAddProduct()}),this.elements.addCategoryButton.on("click",()=>{console.log("Add Category button clicked"),this.handleAddCategory()})},handleAddProduct:function(){console.log("Handling add product with URL:",this.urls.addProductForm),c.get(this.urls.addProductForm).then(t=>(console.log("Product form fetched, showing modal"),n.confirm({title:"Add New Product",html:t.html||t,showCancelButton:!0,confirmButtonText:"Add Product",allowOutsideClick:!1,allowEscapeKey:!1,preConfirm:()=>{const o=e("#product-form")[0],r=new FormData(o);return c.post(this.urls.addProduct,r,{skipGlobalErrorHandler:!0}).then(a=>a).catch(a=>(n.displaySwalError(a,"Failed to add product"),Promise.reject(a)))}}))).then(t=>{var o;t.isConfirmed&&(console.log("Product added successfully, refreshing list"),n.displaySuccess(((o=t.value)==null?void 0:o.message)||"Product added successfully"),this.productManager.fetchItems())}).catch(t=>{console.error("Error handling add product:",t),n.displayError("Failed to load product form: "+(t.message||"Unknown error"))})},handleAddCategory:function(){console.log("Handling add category"),n.prompt({title:"Add New Category",inputPlaceholder:"Enter category name",inputValidator:t=>!t||t.trim()===""?"Please enter a category name":null,preConfirm:t=>(console.log("Adding category:",t),c.post(this.urls.addCategory,{name:t},{skipGlobalErrorHandler:!0}).then(o=>o).catch(o=>(n.displaySwalError(o,"Failed to add category"),Promise.reject(o))))}).then(t=>{var o;t.isConfirmed&&(console.log("Category added successfully, refreshing list"),n.displaySuccess(((o=t.value)==null?void 0:o.message)||"Category added successfully"),this.categoryManager.fetchItems())}).catch(t=>{console.error("Error handling add category:",t)})},initializeAccordion:function(){const t=this.elements.managementAccordion;this.resetAccordion(t),t.find(".accordion-button").on("click",o=>this.handleAccordionToggle(o))},resetAccordion:function(t){t.find(".accordion-button, .accordion-collapse").off(),t.off(),t.find(".accordion-button, .accordion-collapse").removeData("bs.collapse"),t.find('[data-bs-toggle="collapse"]').removeAttr("data-bs-toggle")},handleAccordionToggle:function(t){t.preventDefault(),t.stopPropagation();const o=e(t.currentTarget),r=o.data("bs-target"),a=e(r),d=o.attr("aria-expanded")==="true";if(o.attr("aria-expanded",!d),d)o.addClass("collapsed"),a.removeClass("show");else{this.collapseOtherSections(o,r),o.removeClass("collapsed"),a.addClass("show");const i=r.substring(1);this.loadSectionContent(i)}},collapseOtherSections:function(t,o){const r=this.elements.managementAccordion;r.find(".accordion-button").not(t).attr("aria-expanded","false").addClass("collapsed"),r.find(".accordion-collapse").not(o).removeClass("show")},loadSectionContent:function(t){const a=e(`#${t}`).find(".accordion-body > div").attr("id");a==="product-cards-container"?this.productManager.fetchItems():a==="category-cards-container"&&this.categoryManager.fetchItems()}}).init()});
