import{m as u}from"../chunks/ajax_helper.EulIYOr7.js";import{S as r}from"../chunks/chunks/vendor/common.Dz0GDR6V.js";class h{constructor(e){if(new.target===h)throw new Error("Cannot instantiate BaseManager directly; please use a subclass");this.elements=e.elements,this.urls=e.urls,this.notifications=e.notifications,this.itemType=e.itemType||"item",this.filter=null}fetchItems(){throw new Error("fetchItems() must be implemented by subclass")}initializeFilters(){throw new Error("initializeFilters() must be implemented by subclass")}showForm(e,t=!1,i={}){const o=this.capitalizeFirstLetter(this.itemType),s=t?`#${this.itemType}-update-form`:`#${this.itemType}-form`,a=i.title||(t?`Edit ${o}`:`Add New ${o}`),d=i.confirmText||(t?"Save":`Add ${o}`),y=i.successMessage||(t?`${o} updated successfully.`:`${o} added successfully.`);u(e,"GET",{},c=>{r.fire({title:a,html:t?c.html:c,showCancelButton:!0,confirmButtonText:d,allowOutsideClick:!1,allowEscapeKey:!1,preConfirm:()=>this.handleFormSubmit(t,s)}).then(l=>{var n;l.isConfirmed&&(this.fetchItems(),this.notifications.displaySuccess(((n=l.value)==null?void 0:n.message)||y)),l.isDismissed&&!t&&$(s).remove()}).catch(l=>{console.error("Form submission failed:",l),r.hideLoading();const n=r.getPopup();if(n){const m=n.querySelector(".swal2-confirm"),f=n.querySelector(".swal2-cancel");m&&(m.disabled=!1),f&&(f.disabled=!1)}})},c=>{this.notifications.displaySwalError(c,`Failed to ${t?"edit":"add"} ${this.itemType}.`)})}handleFormSubmit(e,t){r.showLoading();const i=$(t)[0],o=new FormData(i);return u(i.action,"POST",o,s=>{if(!s.success){let a=this.formatErrorMessage(s.errors);return r.hideLoading(),r.showValidationMessage(a),Promise.reject(s.errors)}return s},s=>{console.error(`${this.capitalizeFirstLetter(this.itemType)} form submission error:`,s);let a=`An error occurred while saving the ${this.itemType}.`;return s.responseJSON&&(a=this.formatErrorMessage(s.responseJSON.errors)),r.hideLoading(),r.showValidationMessage(a),Promise.reject(s)},!1,!1)}formatErrorMessage(e){return e?typeof e=="object"?Object.entries(e).map(([t,i])=>Array.isArray(i)?`${t}: ${i.join(", ")}`:`${t}: ${i}`).join(`
`):e:"Unknown error occurred"}confirmAction(e){const t={icon:"warning",showCancelButton:!0,allowOutsideClick:!1,allowEscapeKey:!1,confirmButtonColor:"#d33",cancelButtonColor:"#3085d6",confirmButtonText:"Yes, delete it!"};return r.fire({...t,...e})}capitalizeFirstLetter(e){return e.charAt(0).toUpperCase()+e.slice(1)}destroy(){this.filter&&typeof this.filter.destroy=="function"&&this.filter.destroy(),console.log(`Base ${this.itemType} manager destroyed`)}}export{h as B};
