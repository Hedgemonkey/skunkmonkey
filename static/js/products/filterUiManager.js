import{t as l}from"./formUtils.js";import{a as c}from"../common/apiClient.js";import"../chunks/chunks/vendor/common.Dz0GDR6V.js";import"../chunks/ajax_helper.EulIYOr7.js";class g{constructor(t){this.filter=t,this.container=t.container,this.itemType=t.itemType,this.productCountElement=this.container.find(".product-count")}initialize(){if(this._setupToggleEvents(),this._setupListProductsVisibility(),this._loadInitialItemCount(),this.itemType==="categories"&&!this.productCountElement.length){const t=this.container.find("#filterSummary .results-count");t.length&&(t.append('<span class="ms-2 text-muted product-count-display d-none">| <span class="product-count">0</span> products</span>'),this.productCountElement=this.container.find(".product-count"))}}_loadInitialItemCount(){const t={items_only:!0,count_only:!0};c.get(this.filter.filterUrl,t,{skipGlobalErrorHandler:!0}).then(e=>{let i=0;e.count!==void 0?i=e.count:e.total_count!==void 0?i=e.total_count:typeof e=="string"&&$(e).find(".card").length>0&&(i=$(e).find(".card").length),this.updateItemCountDisplays(i)}).catch(e=>{console.warn("Error loading initial item count:",e),this.updateItemCountDisplays(0)})}_setupToggleEvents(){const t=this.container.find(".filter-toggle"),e=this.container.find("#filterOptions");!t.length||!e.length||(t.on("click",i=>{i.preventDefault(),l(e,{onShow:()=>{t.addClass("active"),t.find(".filter-toggle-text").text("Hide Filters"),t.find("i").removeClass("fa-sliders-h").addClass("fa-times"),t.removeClass("btn-outline-primary").addClass("btn-primary"),t.attr("aria-expanded","true"),this.container.find(".filter-summary-category-tags").hide(),this.itemType==="categories"&&this.container.find(".collapsed-list-products-btn-container").addClass("d-none")},onHide:()=>{if(t.removeClass("active"),t.find(".filter-toggle-text").text("Show Filters"),t.find("i").addClass("fa-sliders-h").removeClass("fa-times"),t.removeClass("btn-primary").addClass("btn-outline-primary"),t.attr("aria-expanded","false"),this.container.find(".filter-summary-category-tags").show(),this.itemType==="categories"){const n=this.filter.categoryManager.getSelectedCategories().length>0;this.container.find(".collapsed-list-products-btn-container").toggleClass("d-none",!n)}}})}),this.container.find("#filterSummary .search-summary .btn-close").on("click",i=>{i.stopPropagation(),this.container.find(".clear-search").click()}),this.container.find("#filterSummary .categories-summary .btn-close").on("click",i=>{i.stopPropagation(),this.container.find(".clear-categories-btn").click()}))}_setupListProductsVisibility(){if(this.itemType!=="categories")return;const t=this.container.find(".collapsed-list-products-btn-container .list-products-btn"),e=this.container.find("#expanded-list-products-btn");t.off("click"),t.on("click",()=>{e.click()});const i=this.filter.categoryManager.getSelectedCategories().length>0,n=this.container.find("#filterOptions").hasClass("show");this.container.find(".collapsed-list-products-btn-container").toggleClass("d-none",n||!i)}updateItemCountDisplays(t){this.container.find(".item-count").text(t);const e=this.container.find(".search-summary .badge");e.length&&e.text(`${t} ${this.itemType}`),this.container.find(".results-count .item-count").text(t),this.itemType==="categories"&&this._updateProductCount()}_updateProductCount(){const t=this.filter.categoryManager.getSelectedCategories();if(!t.length){this.container.find(".selected-stats").addClass("d-none");return}c.get("/products/api/products/count/",{category:t.join(",")},{skipGlobalErrorHandler:!0}).then(e=>{e.product_count!==void 0&&(this.container.find(".product-count").text(e.product_count),this.container.find(".selected-count").text(t.length),this.container.find(".selected-stats").removeClass("d-none"))}).catch(e=>{console.warn("Error fetching product count:",e),this.container.find(".selected-stats").addClass("d-none")})}updateFilterSummary(){const t=this.container.find(".filter-search").val(),e=this.filter.categoryManager.getSelectedCategories(),i=this.container.find("#filterSummary");if(!i.length)return;const n=i.find(".search-summary");t?(n.removeClass("d-none"),n.find(".search-term-summary").text(t)):n.addClass("d-none");const o=i.find(".categories-summary");e.length>0?(o.removeClass("d-none"),o.find(".category-count-summary").text(e.length)):o.addClass("d-none");const r=this.container.find(".active-filters .active-filter-display");if(r.length){const a=r.find(".search-display"),s=r.find(".categories-display");t?(a.removeClass("d-none"),a.find(".search-term").text(t)):a.addClass("d-none"),e.length>0?(s.removeClass("d-none"),s.find(".category-count-display").text(e.length)):s.addClass("d-none")}if(t||e.length>0?i.addClass("d-flex").removeClass("d-none"):this.container.find("#filterOptions").hasClass("show")||i.removeClass("d-flex").addClass("d-none"),this.itemType==="categories"){const a=this.container.find("#filterOptions").hasClass("show"),s=e.length>0;this.container.find(".collapsed-list-products-btn-container").toggleClass("d-none",a||!s),s?this._updateProductCount():this.container.find(".selected-stats").addClass("d-none")}}destroy(){const t=this.container.find(".filter-toggle");t.length&&t.off("click"),this.container.find("#filterSummary .search-summary .btn-close").off("click"),this.container.find("#filterSummary .categories-summary .btn-close").off("click"),this.itemType==="categories"&&this.container.find(".collapsed-list-products-btn-container .list-products-btn").off("click")}}export{g as F};
