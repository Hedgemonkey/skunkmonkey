class a{constructor(){this.liveRegion=null,this.statusRegion=null,this.focusedBeforeModal=null,this.trapFocus=!1}init(){this.createLiveRegions(),this.setupKeyboardNavigation(),this.enhanceFormValidation(),this.setupFocusManagement(),this.announcePageChanges()}createLiveRegions(){this.liveRegion||(this.liveRegion=document.createElement("div"),this.liveRegion.setAttribute("aria-live","assertive"),this.liveRegion.setAttribute("aria-atomic","true"),this.liveRegion.setAttribute("aria-relevant","text"),this.liveRegion.className="visually-hidden",this.liveRegion.id="accessibility-live-region",document.body.appendChild(this.liveRegion)),this.statusRegion||(this.statusRegion=document.createElement("div"),this.statusRegion.setAttribute("aria-live","polite"),this.statusRegion.setAttribute("aria-atomic","true"),this.statusRegion.className="visually-hidden",this.statusRegion.id="accessibility-status-region",document.body.appendChild(this.statusRegion))}announceToScreenReader(e,t="polite"){const i=t==="assertive"?this.liveRegion:this.statusRegion;i&&e&&(i.textContent="",setTimeout(()=>{i.textContent=e},100))}setupKeyboardNavigation(){document.addEventListener("keydown",e=>{if(e.altKey&&e.key==="1"){e.preventDefault();const t=document.getElementById("main-content");t&&(t.focus(),t.scrollIntoView())}if(e.altKey&&e.key==="2"){e.preventDefault();const t=document.getElementById("navbar");if(t){const i=t.querySelector("a, button");i&&i.focus()}}e.key==="Escape"&&this.handleEscapeKey()}),document.addEventListener("keydown",()=>{document.body.classList.add("keyboard-focus")}),document.addEventListener("mousedown",()=>{document.body.classList.remove("keyboard-focus")})}handleEscapeKey(){const e=document.querySelector(".modal.show");if(e){const n=bootstrap.Modal.getInstance(e);n&&n.hide()}const t=document.querySelector(".dropdown-menu.show");if(t){const n=bootstrap.Dropdown.getInstance(t.previousElementSibling);n&&n.hide()}document.querySelectorAll('[data-dismiss="escape"].show, [data-dismiss="escape"].active').forEach(n=>{n.classList.remove("show","active")})}enhanceFormValidation(){document.addEventListener("submit",e=>{e.target.tagName==="FORM"&&this.validateForm(e.target)}),document.addEventListener("blur",e=>{e.target.matches("input, select, textarea")&&this.validateField(e.target)},!0)}validateForm(e){const t=[],i=e.querySelectorAll(":invalid");if(i.forEach(n=>{const o=this.getFieldLabel(n),s=n.validationMessage||"This field is invalid";t.push(`${o}: ${s}`),n.setAttribute("aria-invalid","true"),this.showFieldError(n,s)}),t.length>0){const n=`Form has ${t.length} error${t.length>1?"s":""}: ${t.join(", ")}`;this.announceToScreenReader(n,"assertive"),i[0].focus()}}validateField(e){if(e.checkValidity())e.setAttribute("aria-invalid","false"),this.hideFieldError(e);else{e.setAttribute("aria-invalid","true");const t=e.validationMessage||"This field is invalid";this.showFieldError(e,t)}}getFieldLabel(e){let t=document.querySelector(`label[for="${e.id}"]`);return!t&&e.parentElement&&(t=e.parentElement.querySelector("label")),t?t.textContent.trim():e.name||e.type||"Field"}showFieldError(e,t){let i=document.getElementById(`${e.id}-error`);i||(i=document.createElement("div"),i.id=`${e.id}-error`,i.className="invalid-feedback d-block",i.setAttribute("role","alert"),i.setAttribute("aria-live","polite"),e.parentElement.appendChild(i)),i.textContent=t,e.setAttribute("aria-describedby",i.id)}hideFieldError(e){const t=document.getElementById(`${e.id}-error`);t&&t.remove(),e.removeAttribute("aria-describedby")}setupFocusManagement(){document.addEventListener("shown.bs.modal",e=>{this.focusedBeforeModal=document.activeElement;const i=e.target.querySelector('[autofocus], input, select, textarea, button, [tabindex]:not([tabindex="-1"])');i&&i.focus()}),document.addEventListener("hidden.bs.modal",()=>{this.focusedBeforeModal&&(this.focusedBeforeModal.focus(),this.focusedBeforeModal=null)})}announcePageChanges(){new MutationObserver(t=>{t.forEach(i=>{i.type==="childList"&&i.addedNodes.length>0&&i.addedNodes.forEach(n=>{n.nodeType===Node.ELEMENT_NODE&&n.querySelectorAll("[aria-live]").forEach(s=>{s.textContent.trim()&&this.announceToScreenReader(s.textContent.trim(),s.getAttribute("aria-live")==="assertive"?"assertive":"polite")})})})}).observe(document.body,{childList:!0,subtree:!0})}static announce(e,t="polite"){window.accessibilityManager&&window.accessibilityManager.announceToScreenReader(e,t)}}document.addEventListener("DOMContentLoaded",()=>{window.accessibilityManager=new a,window.accessibilityManager.init(),window.announceToScreenReader=a.announce});
