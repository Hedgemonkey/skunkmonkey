/* empty css                               */import{A as c}from"../common/apiClient.js";import"../chunks/ajax_helper.EulIYOr7.js";import"../chunks/chunks/vendor/common.Dz0GDR6V.js";class u{constructor(){this.api=new c({errorHandler:this.handleApiError.bind(this)}),this.cartContainer=document.getElementById("cart-container"),this.cartTotal=document.getElementById("cart-total"),this.cartCount=document.getElementById("cart-count"),this.cartCountBadge=document.querySelector(".cart-count-badge"),this.initEventListeners()}initEventListeners(){document.querySelectorAll('.add-to-cart-form[data-direct-submit="true"]').forEach(t=>{t.addEventListener("submit",this.handleAddToCart.bind(this))}),document.querySelectorAll(".update-cart-form").forEach(t=>{t.addEventListener("submit",this.handleUpdateSubmit.bind(this))}),document.querySelectorAll(".remove-cart-item").forEach(t=>{t.addEventListener("click",this.handleRemoveItem.bind(this))}),this.initQuantityButtons(),this.initCartQuantityButtons()}initCartQuantityButtons(){const t=document.querySelectorAll(".quantity-decrease, .btn-decrease"),e=document.querySelectorAll(".quantity-increase, .btn-increase");t.forEach(a=>{a.addEventListener("click",o=>{console.log("Decrease button clicked");const i=a.closest(".update-cart-form");if(!i){console.error("Could not find parent form for decrease button:",a);return}const n=i.querySelector(".quantity-input"),r=parseInt(n.value);r>1&&(n.value=r-1,this.updateCartItemQuantity(i))})}),e.forEach(a=>{a.addEventListener("click",o=>{console.log("Increase button clicked");const i=a.closest(".update-cart-form");if(!i){console.error("Could not find parent form for increase button:",a);return}const n=i.querySelector(".quantity-input"),r=parseInt(n.value),s=parseInt(n.dataset.maxStock||Number.MAX_SAFE_INTEGER);r<s?(n.value=r+1,this.updateCartItemQuantity(i)):this.showNotification("Maximum Quantity",`Sorry, only ${s} units available.`,"info")})}),document.querySelectorAll(".quantity-input").forEach(a=>{a.addEventListener("change",o=>{console.log("Quantity input changed");const i=a.closest(".update-cart-form");if(!i){console.error("Could not find parent form for quantity input:",a);return}const n=parseInt(a.dataset.maxStock||Number.MAX_SAFE_INTEGER);let r=parseInt(a.value);isNaN(r)||r<1?(r=1,a.value=r):r>n&&(r=n,a.value=r,this.showNotification("Maximum Quantity",`Sorry, only ${n} units available.`,"info")),this.updateCartItemQuantity(i)})})}updateCartItemQuantity(t){if(!t||!t.action){console.error("Invalid form or form action:",t);return}const e=t.querySelector(".quantity-control");e&&e.classList.add("updating");const a=new FormData(t);console.log("Making AJAX request to:",t.action),this.api.post(t.action,a).then(o=>{if(console.log("AJAX response:",o),o.success){e&&e.classList.remove("updating");const n=t.closest("tr").querySelector(".item-subtotal");n&&(n.textContent=`Â£${o.item_subtotal}`,n.classList.add("highlight-update"),setTimeout(()=>{n.classList.remove("highlight-update")},1e3)),this.cartTotal&&(this.cartTotal.textContent=`Â£${o.cart_total}`,this.cartTotal.classList.add("highlight-update"),setTimeout(()=>{this.cartTotal.classList.remove("highlight-update")},1e3)),this.cartCountBadge&&(this.cartCountBadge.textContent=o.item_count);const r=t.querySelector(".quantity-input");r&&o.item_quantity&&(r.value=o.item_quantity),this.showNotification("Cart Updated","Your cart has been updated successfully.","success",!0,{timer:2e3,timerProgressBar:!0,showConfirmButton:!1})}}).catch(o=>{console.error("Update cart error:",o),e&&e.classList.remove("updating"),this.handleApiError(o)})}initQuantityButtons(){const t=document.getElementById("quantity"),e=document.getElementById("decrease-quantity"),a=document.getElementById("increase-quantity");e&&a&&t&&(e.addEventListener("click",()=>{const o=parseInt(t.value);o>1&&(t.value=o-1)}),a.addEventListener("click",()=>{const o=parseInt(t.value),i=parseInt(t.getAttribute("max"));o<i?t.value=o+1:this.showNotification("Maximum Quantity",`Sorry, only ${i} units available.`,"info")}))}handleAddToCart(t){var n,r;t.preventDefault();const e=t.target,a=e.action,o=new FormData(e);(r=(n=e.closest(".product-info"))==null?void 0:n.querySelector("h1"))!=null&&r.textContent;const i=e.querySelector('button[type="submit"]');this.showNotification("Adding to Cart...","Please wait...","info",!1),this.api.post(a,o).then(s=>{s.success&&(i&&(i.classList.add("add-to-cart-animation"),setTimeout(()=>{i.classList.remove("add-to-cart-animation")},1500)),this.cartCount&&(this.cartCount.textContent=s.item_count,this.cartCount.classList.add("cart-count-updated"),setTimeout(()=>{this.cartCount.classList.remove("cart-count-updated")},500)),this.cartCountBadge&&(this.cartCountBadge.textContent=s.item_count,this.cartCountBadge.classList.remove("d-none")),this.showCartSummaryToast(s))})}showCartSummaryToast(t){let e="";t.cart_items&&t.cart_items.length>0&&(e=t.cart_items.map(a=>`<div class="d-flex justify-content-between align-items-center mb-1">
                    <span class="text-truncate me-2">${a.name} Ã— ${a.quantity}</span>
                    <span class="text-muted">Â£${a.total_price}</span>
                </div>`).join(""),t.total_unique_items>t.cart_items.length&&(e+=`<div class="text-muted small">... and ${t.total_unique_items-t.cart_items.length} more items</div>`)),this.showNotification("ðŸ›’ Added to Cart!",`<div class="text-start">
                <p class="mb-3"><strong>${t.quantity_added} Ã— ${t.product_name}</strong> added to your cart</p>
                <hr>
                <h6>Cart Summary (${t.item_count} items)</h6>
                <div class="mb-3">${e}</div>
                <div class="d-flex justify-content-between fw-bold">
                    <span>Total:</span>
                    <span>Â£${t.cart_total}</span>
                </div>
            </div>`,"success",!0,{showDenyButton:!0,denyButtonText:'<i class="fas fa-credit-card me-1"></i> Go to Checkout',denyButtonColor:"#198754",confirmButtonText:'<i class="fas fa-shopping-bag me-1"></i> Continue Shopping'}).then(a=>{a.isDenied&&(window.location.href="/shop/cart/")})}handleUpdateSubmit(t){t.preventDefault();const e=t.target;if(!e||!e.action){console.error("Invalid form or form action in handleUpdateSubmit:",e);return}this.updateCartItemQuantity(e)}handleRemoveItem(t){t.preventDefault();const e=t.currentTarget,a=e.href,o=e.dataset.productName||"this item";this.showConfirmation("Remove Item?",`Are you sure you want to remove ${o} from your cart?`,()=>{this.api.get(a).then(i=>{if(i.success){const n=e.closest("tr");n.classList.add("fade-out"),setTimeout(()=>{n.remove(),this.cartTotal&&(this.cartTotal.textContent=`Â£${i.cart_total}`),this.cartCountBadge&&(i.item_count>0?this.cartCountBadge.textContent=i.item_count:this.cartCountBadge.classList.add("d-none")),i.item_count===0&&window.location.reload()},300),this.showNotification("Item Removed",`${o} has been removed from your cart.`,"success")}})})}showConfirmation(t,e,a){typeof Swal<"u"?Swal.fire({title:t,text:e,icon:"question",showCancelButton:!0,confirmButtonColor:"#dc3545",cancelButtonColor:"#6c757d",confirmButtonText:"Yes, remove it",cancelButtonText:"No, keep it"}).then(o=>{o.isConfirmed&&a()}):confirm(e)&&a()}handleApiError(t){console.error("API Error:",t),this.showNotification("Error",t.message||"There was a problem with your request.","error")}showNotification(t,e,a,o=!0,i={}){return typeof Swal<"u"?Swal.fire({title:t,text:e,icon:a,confirmButtonColor:"#0d6efd",...i}):(alert(`${t}: ${e}`),Promise.resolve())}}document.addEventListener("DOMContentLoaded",function(){window.cartManager=new u});
