import{$ as n}from"../chunks/chunks/vendor/common.Dz0GDR6V.js";import"../chunks/chunks/vendor/bootstrap.DA4YfA_0.js";console.log("Account actions module loaded");class s{constructor(){this.actionButton=document.querySelector('[data-account-action="manage"]'),this.modal=document.getElementById("accountActionModal"),this.deactivateBtn=document.getElementById("deactivateAccount"),this.deleteBtn=document.getElementById("deleteAccount"),this.deactivateConfirmModal=document.getElementById("deactivateConfirmModal"),this.deleteConfirmModal=document.getElementById("deleteConfirmModal"),this.confirmDeactivateBtn=document.getElementById("confirmDeactivate"),this.confirmDeleteBtn=document.getElementById("confirmDelete"),this.deleteConfirmationInput=document.getElementById("deleteConfirmationInput"),this.modalInstance=null,this.deactivateConfirmModalInstance=null,this.deleteConfirmModalInstance=null,this.init()}init(){if(!this.actionButton||!this.modal){console.error("Required elements for account actions not found");return}typeof bootstrap<"u"&&bootstrap.Modal&&(this.modalInstance=new bootstrap.Modal(this.modal),this.deactivateConfirmModal&&(this.deactivateConfirmModalInstance=new bootstrap.Modal(this.deactivateConfirmModal)),this.deleteConfirmModal&&(this.deleteConfirmModalInstance=new bootstrap.Modal(this.deleteConfirmModal))),this.bindEvents(),console.log("Account manager initialized")}bindEvents(){this.actionButton.addEventListener("click",t=>{t.preventDefault(),this.openModal()}),this.deactivateBtn&&this.deactivateBtn.addEventListener("click",t=>{t.preventDefault(),this.showDeactivateConfirmation()}),this.deleteBtn&&this.deleteBtn.addEventListener("click",t=>{t.preventDefault(),this.showDeleteConfirmation()}),this.confirmDeactivateBtn&&this.confirmDeactivateBtn.addEventListener("click",()=>{this.deactivateAccount()}),this.confirmDeleteBtn&&this.confirmDeleteBtn.addEventListener("click",()=>{this.deleteAccount()}),this.deleteConfirmationInput&&(this.deleteConfirmationInput.addEventListener("input",()=>{this.validateDeleteConfirmation()}),this.deleteConfirmModal&&this.deleteConfirmModal.addEventListener("hidden.bs.modal",()=>{this.deleteConfirmationInput.value="",this.validateDeleteConfirmation()}))}openModal(){this.modalInstance?this.modalInstance.show():typeof n<"u"?n(this.modal).modal("show"):(this.modal.style.display="block",this.modal.classList.add("show"))}showDeactivateConfirmation(){this.modalInstance&&this.modalInstance.hide(),this.deactivateConfirmModalInstance?this.deactivateConfirmModalInstance.show():typeof n<"u"?n(this.deactivateConfirmModal).modal("show"):(this.deactivateConfirmModal.style.display="block",this.deactivateConfirmModal.classList.add("show"))}showDeleteConfirmation(){this.modalInstance&&this.modalInstance.hide(),this.deleteConfirmModalInstance?this.deleteConfirmModalInstance.show():typeof n<"u"?n(this.deleteConfirmModal).modal("show"):(this.deleteConfirmModal.style.display="block",this.deleteConfirmModal.classList.add("show"))}validateDeleteConfirmation(){if(!this.deleteConfirmationInput||!this.confirmDeleteBtn)return;const e=this.deleteConfirmationInput.value.trim()==="DELETE";this.confirmDeleteBtn.disabled=!e,e?(this.confirmDeleteBtn.classList.remove("disabled"),this.confirmDeleteBtn.setAttribute("aria-describedby","delete-button-enabled-help")):(this.confirmDeleteBtn.classList.add("disabled"),this.confirmDeleteBtn.setAttribute("aria-describedby","delete-button-help"))}deactivateAccount(){const t=this.actionButton.dataset.deactivateUrl,e=this.actionButton.dataset.deactivateRedirectUrl;if(!t){console.error("Deactivation URL not provided");return}this.deactivateConfirmModalInstance&&this.deactivateConfirmModalInstance.hide(),this.sendAccountAction(t,e)}deleteAccount(){const t=this.actionButton.dataset.deleteUrl,e=this.actionButton.dataset.deleteRedirectUrl;if(!t){console.error("Deletion URL not provided");return}if((this.deleteConfirmationInput?this.deleteConfirmationInput.value.trim():"")!=="DELETE"){console.error("Delete confirmation not properly entered");return}this.deleteConfirmModalInstance&&this.deleteConfirmModalInstance.hide(),this.sendAccountAction(t,e,"DELETE")}sendAccountAction(t,e,i="POST"){const o=this.getCsrfToken();if(!o){console.error("CSRF token not found");return}fetch(t,{method:i,headers:{"Content-Type":"application/json","X-CSRFToken":o},credentials:"same-origin"}).then(a=>{if(a.ok)e?window.location.href=e:window.location.reload();else throw new Error("Error processing account action")}).catch(a=>{console.error("Account action error:",a),alert("An error occurred while processing your request. Please try again later.")})}getCsrfToken(){const t=document.cookie.split(";");for(let i=0;i<t.length;i++){const o=t[i].trim();if(o.startsWith("csrftoken="))return o.substring(10)}const e=document.querySelector('[name="csrfmiddlewaretoken"]');return e?e.value:null}}document.addEventListener("DOMContentLoaded",function(){console.log("DOM loaded in account_actions.js"),new s});n(function(){console.log("jQuery ready in account_actions.js"),window.accountManager||(window.accountManager=new s)});window.AccountManager=s;
