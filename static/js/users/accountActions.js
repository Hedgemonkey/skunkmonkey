import{$ as c}from"../chunks/chunks/vendor/common.Dz0GDR6V.js";import"../chunks/chunks/vendor/bootstrap.DA4YfA_0.js";console.log("Account actions module loaded");class i{constructor(){this.actionButton=document.querySelector('[data-account-action="manage"]'),this.modal=document.getElementById("accountActionModal"),this.deactivateBtn=document.getElementById("deactivateAccount"),this.deleteBtn=document.getElementById("deleteAccount"),this.modalInstance=null,this.init()}init(){if(!this.actionButton||!this.modal){console.error("Required elements for account actions not found");return}typeof bootstrap<"u"&&bootstrap.Modal&&(this.modalInstance=new bootstrap.Modal(this.modal)),this.bindEvents(),console.log("Account manager initialized")}bindEvents(){this.actionButton.addEventListener("click",t=>{t.preventDefault(),this.openModal()}),this.deactivateBtn&&this.deactivateBtn.addEventListener("click",t=>{t.preventDefault(),this.deactivateAccount()}),this.deleteBtn&&this.deleteBtn.addEventListener("click",t=>{t.preventDefault(),this.deleteAccount()})}openModal(){this.modalInstance?this.modalInstance.show():typeof c<"u"?c(this.modal).modal("show"):(this.modal.style.display="block",this.modal.classList.add("show"))}deactivateAccount(){const t=this.actionButton.dataset.deactivateUrl,e=this.actionButton.dataset.deactivateRedirectUrl;if(!t){console.error("Deactivation URL not provided");return}confirm("Are you sure you want to deactivate your account? You can reactivate it later by logging in.")&&this.sendAccountAction(t,e)}deleteAccount(){const t=this.actionButton.dataset.deleteUrl,e=this.actionButton.dataset.deleteRedirectUrl;if(!t){console.error("Deletion URL not provided");return}confirm("WARNING: This will permanently delete all your account data. This action cannot be undone. Are you absolutely sure?")&&confirm("Please confirm once more that you want to delete your account permanently.")&&this.sendAccountAction(t,e)}sendAccountAction(t,e){const o=this.getCsrfToken();if(!o){console.error("CSRF token not found");return}fetch(t,{method:"POST",headers:{"Content-Type":"application/json","X-CSRFToken":o},credentials:"same-origin"}).then(n=>{if(n.ok)e?window.location.href=e:window.location.reload();else throw new Error("Error processing account action")}).catch(n=>{console.error("Account action error:",n),alert("An error occurred while processing your request. Please try again later.")})}getCsrfToken(){const t=document.cookie.split(";");for(let o=0;o<t.length;o++){const n=t[o].trim();if(n.startsWith("csrftoken="))return n.substring(10)}const e=document.querySelector('[name="csrfmiddlewaretoken"]');return e?e.value:null}}document.addEventListener("DOMContentLoaded",function(){console.log("DOM loaded in account_actions.js"),new i});c(function(){console.log("jQuery ready in account_actions.js"),window.accountManager||(window.accountManager=new i)});window.AccountManager=i;
