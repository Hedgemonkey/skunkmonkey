document.addEventListener("DOMContentLoaded",function(){const r=document.querySelector(".home-carousel");r&&v(r),document.querySelectorAll(".product-card").forEach(o=>{o.addEventListener("mouseenter",function(){this.classList.add("shadow")}),o.addEventListener("mouseleave",function(){this.classList.remove("shadow")})});const c=document.querySelectorAll(".testimonial-img[data-src]");if("IntersectionObserver"in window){const o=new IntersectionObserver(i=>{i.forEach(n=>{if(n.isIntersecting){const s=n.target,e=s.getAttribute("data-src");e&&(s.src=e,s.removeAttribute("data-src")),o.unobserve(s)}})});c.forEach(i=>{o.observe(i)})}else c.forEach(o=>{const i=o.getAttribute("data-src");i&&(o.src=i,o.removeAttribute("data-src"))});const t=document.querySelectorAll(".category-filter-btn");t.forEach(o=>{o.addEventListener("click",function(){const i=this.getAttribute("data-category");if(t.forEach(n=>n.classList.remove("active")),this.classList.add("active"),i==="all"){document.querySelectorAll(".product-item").forEach(n=>{n.style.display="block"});return}document.querySelectorAll(".product-item").forEach(n=>{n.style.display="none"}),document.querySelectorAll(`.product-item[data-category="${i}"]`).forEach(n=>{n.style.display="block"})})}),document.querySelectorAll(".btn-add-to-cart").forEach(o=>{o.addEventListener("click",function(i){i.preventDefault();const n=this.getAttribute("data-product-id");this.disabled=!0;const s=this.innerHTML;this.innerHTML='<i class="fas fa-spinner fa-spin"></i>',fetch(`/cart/add/${n}/`,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded","X-Requested-With":"XMLHttpRequest","X-CSRFToken":f()},body:"quantity=1&update=False"}).then(e=>e.json()).then(e=>{if(this.disabled=!1,this.innerHTML=s,e.success){d("success",e.message);const a=document.querySelector(".cart-count");a&&(a.textContent=e.item_count)}else d("error",e.errors||"Error adding to cart")}).catch(e=>{this.disabled=!1,this.innerHTML=s,d("error","Error adding to cart"),console.error("Error:",e)})})}),document.querySelectorAll(".btn-wishlist").forEach(o=>{o.addEventListener("click",function(i){i.preventDefault();const n=this.getAttribute("data-product-id");this.disabled=!0,fetch(`/wishlist/toggle/${n}/`,{method:"POST",headers:{"X-Requested-With":"XMLHttpRequest","X-CSRFToken":f()}}).then(s=>s.json()).then(s=>{if(this.disabled=!1,s.success){const e=this.querySelector("i");s.action==="added"?(e.classList.remove("far"),e.classList.add("fas"),d("success","Added to wishlist")):(e.classList.remove("fas"),e.classList.add("far"),d("success","Removed from wishlist"))}else s.error==="login_required"?d("info","Please log in to add items to your wishlist"):d("error",s.error||"Error updating wishlist")}).catch(s=>{this.disabled=!1,d("error","Error updating wishlist"),console.error("Error:",s)})})})});function v(r){const l=r.querySelectorAll(".carousel-slide");if(l.length===0)return;let c=0;const t=l.length;l.forEach((e,a)=>{e.style.display=a===0?"block":"none"});const u=document.createElement("div");u.className="carousel-dots";for(let e=0;e<t;e++){const a=document.createElement("span");a.className="carousel-dot",e===0&&a.classList.add("active"),a.addEventListener("click",()=>{s(e)}),u.appendChild(a)}r.appendChild(u);const h=document.createElement("button");h.className="carousel-button carousel-prev",h.innerHTML="&lt;",h.addEventListener("click",()=>{s((c-1+t)%t)});const o=document.createElement("button");o.className="carousel-button carousel-next",o.innerHTML="&gt;",o.addEventListener("click",()=>{s((c+1)%t)}),r.appendChild(h),r.appendChild(o);const i=5e3;let n=setInterval(()=>{s((c+1)%t)},i);r.addEventListener("mouseenter",()=>{clearInterval(n)}),r.addEventListener("mouseleave",()=>{n=setInterval(()=>{s((c+1)%t)},i)});function s(e){l[c].style.display="none",u.querySelectorAll(".carousel-dot").forEach((a,m)=>{a.classList.toggle("active",m===e)}),l[e].style.display="block",c=e}}function f(){const r=document.cookie.split(";");for(let l of r){const[c,t]=l.trim().split("=");if(c==="csrftoken")return t}return""}function d(r,l){let c=document.querySelector(".toast-container");c||(c=document.createElement("div"),c.className="toast-container",document.body.appendChild(c));const t=document.createElement("div");t.className=`toast toast-${r}`,t.innerHTML=`
        <div class="toast-header">
            <i class="fas fa-${r==="success"?"check-circle":r==="error"?"exclamation-circle":"info-circle"}"></i>
            <span class="toast-title">${r.charAt(0).toUpperCase()+r.slice(1)}</span>
            <button class="toast-close">&times;</button>
        </div>
        <div class="toast-body">${l}</div>
    `,c.appendChild(t),setTimeout(()=>{t.classList.add("show")},10),t.querySelector(".toast-close").addEventListener("click",()=>{t.classList.remove("show"),setTimeout(()=>{t.remove()},300)}),setTimeout(()=>{t.parentNode&&(t.classList.remove("show"),setTimeout(()=>{t.parentNode&&t.remove()},300))},5e3)}
