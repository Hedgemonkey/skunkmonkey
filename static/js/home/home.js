document.addEventListener("DOMContentLoaded",function(){const r=document.querySelector(".home-carousel");r&&v(r),document.querySelectorAll(".product-card").forEach(s=>{s.addEventListener("mouseenter",function(){this.classList.add("shadow")}),s.addEventListener("mouseleave",function(){this.classList.remove("shadow")})});const c=document.querySelectorAll(".testimonial-img[data-src]");if("IntersectionObserver"in window){const s=new IntersectionObserver((n,i)=>{n.forEach(o=>{if(o.isIntersecting){const e=o.target,a=e.getAttribute("data-src");a&&(e.src=a,e.removeAttribute("data-src")),s.unobserve(e)}})});c.forEach(n=>{s.observe(n)})}else c.forEach(s=>{const n=s.getAttribute("data-src");n&&(s.src=n,s.removeAttribute("data-src"))});const t=document.querySelectorAll(".category-filter-btn");t.forEach(s=>{s.addEventListener("click",function(){const n=this.getAttribute("data-category");if(t.forEach(i=>i.classList.remove("active")),this.classList.add("active"),n==="all"){document.querySelectorAll(".product-item").forEach(i=>{i.style.display="block"});return}document.querySelectorAll(".product-item").forEach(i=>{i.style.display="none"}),document.querySelectorAll(`.product-item[data-category="${n}"]`).forEach(i=>{i.style.display="block"})})}),document.querySelectorAll(".btn-add-to-cart").forEach(s=>{s.addEventListener("click",function(n){n.preventDefault();const i=this.getAttribute("data-product-id");this.disabled=!0;const o=this.innerHTML;this.innerHTML='<i class="fas fa-spinner fa-spin"></i>',fetch(`/cart/add/${i}/`,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded","X-Requested-With":"XMLHttpRequest","X-CSRFToken":f()},body:"quantity=1&update=False"}).then(e=>e.json()).then(e=>{if(this.disabled=!1,this.innerHTML=o,e.success){d("success",e.message);const a=document.querySelector(".cart-count");a&&(a.textContent=e.item_count)}else d("error",e.errors||"Error adding to cart")}).catch(e=>{this.disabled=!1,this.innerHTML=o,d("error","Error adding to cart"),console.error("Error:",e)})})}),document.querySelectorAll(".btn-wishlist").forEach(s=>{s.addEventListener("click",function(n){n.preventDefault();const i=this.getAttribute("data-product-id");this.disabled=!0,fetch(`/wishlist/toggle/${i}/`,{method:"POST",headers:{"X-Requested-With":"XMLHttpRequest","X-CSRFToken":f()}}).then(o=>o.json()).then(o=>{if(this.disabled=!1,o.success){const e=this.querySelector("i");o.action==="added"?(e.classList.remove("far"),e.classList.add("fas"),d("success","Added to wishlist")):(e.classList.remove("fas"),e.classList.add("far"),d("success","Removed from wishlist"))}else o.error==="login_required"?d("info","Please log in to add items to your wishlist"):d("error",o.error||"Error updating wishlist")}).catch(o=>{this.disabled=!1,d("error","Error updating wishlist"),console.error("Error:",o)})})})});function v(r){const l=r.querySelectorAll(".carousel-slide");if(l.length===0)return;let c=0;const t=l.length;l.forEach((e,a)=>{e.style.display=a===0?"block":"none"});const u=document.createElement("div");u.className="carousel-dots";for(let e=0;e<t;e++){const a=document.createElement("span");a.className="carousel-dot",e===0&&a.classList.add("active"),a.addEventListener("click",()=>{o(e)}),u.appendChild(a)}r.appendChild(u);const h=document.createElement("button");h.className="carousel-button carousel-prev",h.innerHTML="&lt;",h.addEventListener("click",()=>{o((c-1+t)%t)});const s=document.createElement("button");s.className="carousel-button carousel-next",s.innerHTML="&gt;",s.addEventListener("click",()=>{o((c+1)%t)}),r.appendChild(h),r.appendChild(s);const n=5e3;let i=setInterval(()=>{o((c+1)%t)},n);r.addEventListener("mouseenter",()=>{clearInterval(i)}),r.addEventListener("mouseleave",()=>{i=setInterval(()=>{o((c+1)%t)},n)});function o(e){l[c].style.display="none",u.querySelectorAll(".carousel-dot").forEach((a,m)=>{a.classList.toggle("active",m===e)}),l[e].style.display="block",c=e}}function f(){const r=document.cookie.split(";");for(let l of r){const[c,t]=l.trim().split("=");if(c==="csrftoken")return t}return""}function d(r,l){let c=document.querySelector(".toast-container");c||(c=document.createElement("div"),c.className="toast-container",document.body.appendChild(c));const t=document.createElement("div");t.className=`toast toast-${r}`,t.innerHTML=`
        <div class="toast-header">
            <i class="fas fa-${r==="success"?"check-circle":r==="error"?"exclamation-circle":"info-circle"}"></i>
            <span class="toast-title">${r.charAt(0).toUpperCase()+r.slice(1)}</span>
            <button class="toast-close">&times;</button>
        </div>
        <div class="toast-body">${l}</div>
    `,c.appendChild(t),setTimeout(()=>{t.classList.add("show")},10),t.querySelector(".toast-close").addEventListener("click",()=>{t.classList.remove("show"),setTimeout(()=>{t.remove()},300)}),setTimeout(()=>{t.parentNode&&(t.classList.remove("show"),setTimeout(()=>{t.parentNode&&t.remove()},300))},5e3)}
