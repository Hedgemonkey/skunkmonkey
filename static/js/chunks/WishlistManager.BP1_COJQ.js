import{d as n}from"./chunks/vendor/fontawesome.z_C5Drto.js";class d{constructor(e){this.plm=e}handleWishlistButtonClick(e,t){e.preventDefault(),t.dataset.productId;const i=t.getAttribute("href");let s=this.findHeartIcon(t);if(!s){console.error("Wishlist button missing heart icon element. Button HTML:",t.outerHTML);const r=document.createElement("i");this.setIconClasses(r,["far","fa-heart"]),t.appendChild(r),s=r}const o=this.getIconClasses(s);this.setIconClasses(s,["fas","fa-spinner","fa-spin"]),fetch(i,{method:"POST",headers:{"X-CSRFToken":this.getCookie("csrftoken"),"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"},credentials:"same-origin"}).then(r=>{if(!r.ok)throw new Error(`Server returned ${r.status}: ${r.statusText}`);return r.json()}).then(r=>{let a=this.findHeartIcon(t);if(r.success){const l=t.dataset.productName||"Product";r.added?(this.setIconClasses(a,["fas","fa-heart"]),t.classList.remove("add-to-wishlist-btn"),t.classList.add("remove-wishlist-btn"),t.setAttribute("title","Remove from wishlist"),this.showToast("Added to Wishlist",r.message||`${l} has been added to your wishlist.`,"success")):r.removed&&(this.setIconClasses(a,["far","fa-heart"]),t.classList.remove("remove-wishlist-btn"),t.classList.add("add-to-wishlist-btn"),t.setAttribute("title","Add to wishlist"),this.showToast("Removed from Wishlist",r.message||`${l} has been removed from your wishlist.`,"info")),r.wishlist_count!==void 0&&this.updateWishlistCounter(r.wishlist_count)}else this.setIconClasses(a,o),this.showToast("Error",r.message||"An error occurred","error")}).catch(r=>{console.error("Wishlist operation failed:",r);let a=this.findHeartIcon(t);this.setIconClasses(a,o)})}updateWishlistCounter(e){try{[".wishlist-count","[data-wishlist-count]","#wishlist-count",".wishlist-counter",".nav-wishlist-count"].forEach(s=>{document.querySelectorAll(s).forEach(r=>{r.textContent=e,r.hasAttribute("data-wishlist-count")&&r.setAttribute("data-wishlist-count",e)})}),document.querySelectorAll('a[href*="wishlist"]').forEach(s=>{const o=s.textContent.trim();o.includes("(")&&o.includes(")")&&(s.textContent=o.replace(/\(\d+\)/,`(${e})`))}),console.log(`Updated wishlist counter to: ${e}`)}catch(t){console.error("Error updating wishlist counter:",t)}}findHeartIcon(e){let t=e.querySelector('i.fa-heart, i[class*="fa-heart"]');return t||(t=e.querySelector("svg")),t||(t=e.querySelector("i")),t}setIconClasses(e,t){if(e)if(e.tagName.toLowerCase()==="i"){if(e.hasAttribute("data-fa-i2svg")){this.replaceFontAwesomeIcon(e,t);return}["fa-heart","fas","far","fab","fal","fa-spinner","fa-spin"].forEach(o=>e.classList.remove(o)),t.forEach(o=>{o&&o.trim().length>0&&e.classList.add(o.trim())}),requestAnimationFrame(()=>{setTimeout(()=>{n.i2svg({node:e}),setTimeout(()=>{e&&e.tagName==="I"&&!e.hasAttribute("data-fa-i2svg")&&(console.log("FontAwesome icon not converted, retrying..."),n.i2svg({node:e}))},100)},50)})}else if(e.tagName.toLowerCase()==="svg")this.replaceFontAwesomeIcon(e,t);else try{["fa-heart","fas","far","fab","fal","fa-spinner","fa-spin"].forEach(s=>e.classList.remove(s)),t.forEach(s=>{s&&s.trim().length>0&&e.classList.add(s.trim())}),requestAnimationFrame(()=>{setTimeout(()=>{n.i2svg({node:e}),setTimeout(()=>{e&&e.tagName==="I"&&!e.hasAttribute("data-fa-i2svg")&&(console.log("FontAwesome icon not converted, retrying..."),n.i2svg({node:e}))},100)},50)})}catch(i){console.error("Error setting icon classes:",i)}}getIconClasses(e){if(!e)return[];try{return Array.from(e.classList)}catch(t){return console.error("Error getting icon classes:",t),[]}}getCookie(e){let t=null;if(document.cookie&&document.cookie!==""){const i=document.cookie.split(";");for(let s of i)if(s=s.trim(),s.substring(0,e.length+1)===e+"="){t=decodeURIComponent(s.substring(e.length+1));break}}return t}showToast(e,t,i="info"){try{typeof Swal<"u"?Swal.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:3e3,timerProgressBar:!0,didOpen:o=>{o.addEventListener("mouseenter",Swal.stopTimer),o.addEventListener("mouseleave",Swal.resumeTimer)}}).fire({icon:i,title:e,text:t}):console.log(`${i.toUpperCase()}: ${e} - ${t}`)}catch(s){console.error("Error showing toast notification:",s),console.log(`${i.toUpperCase()}: ${e} - ${t}`)}}replaceFontAwesomeIcon(e,t){try{if(!e.parentNode){console.warn("SVG icon is no longer in the DOM, skipping replacement");return}if(!e.closest("button, a")){console.warn("Could not find parent button for SVG icon");return}const s=document.createElement("i");return t.forEach(o=>{o&&o.trim().length>0&&s.classList.add(o.trim())}),e.dataset&&Object.keys(e.dataset).forEach(o=>{s.dataset[o]=e.dataset[o]}),e.parentNode.replaceChild(s,e),requestAnimationFrame(()=>{setTimeout(()=>{n.i2svg({node:s}),setTimeout(()=>{s&&s.tagName==="I"&&!s.hasAttribute("data-fa-i2svg")&&(console.log("FontAwesome icon not converted, retrying..."),n.i2svg({node:s}))},100)},50)}),console.log("Replaced SVG icon with new i element:",{newClasses:t,newElement:s}),s}catch(i){return console.error("Error replacing Font Awesome SVG icon:",i),null}}positionWishlistButtons(){try{document.querySelectorAll(".product-card").forEach(t=>{const i=t.querySelector(".product-badges"),s=t.querySelector(".add-to-wishlist-btn");i&&s&&(i.querySelectorAll(".badge").length>0?(s.style.top="auto",s.style.bottom="10px",s.style.right="10px"):(s.style.top="10px",s.style.bottom="auto",s.style.right="10px"))})}catch(e){console.error("Error positioning wishlist buttons:",e)}}}export{d as W};
