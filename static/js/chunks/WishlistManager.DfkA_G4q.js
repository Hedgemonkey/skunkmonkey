class c{constructor(t){this.plm=t}handleWishlistButtonClick(t,s){t.preventDefault(),s.dataset.productId;const i=s.getAttribute("href");let e=this.findHeartIcon(s);if(!e){console.error("Wishlist button missing heart icon element. Button HTML:",s.outerHTML);const o=document.createElement("i");this.setIconClasses(o,["far","fa-heart"]),s.appendChild(o),e=o}const r=this.getIconClasses(e);this.setIconClasses(e,["fas","fa-spinner","fa-spin"]),fetch(i,{method:"POST",headers:{"X-CSRFToken":this.getCookie("csrftoken"),"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"},credentials:"same-origin"}).then(o=>{if(!o.ok)throw new Error(`Server returned ${o.status}: ${o.statusText}`);return o.json()}).then(o=>{let n=this.findHeartIcon(s);if(o.success){const a=s.dataset.productName||"Product";o.added?(this.setIconClasses(n,["fas","fa-heart"]),s.classList.remove("add-to-wishlist-btn"),s.classList.add("remove-wishlist-btn"),s.setAttribute("title","Remove from wishlist"),this.showToast("Added to Wishlist",o.message||`${a} has been added to your wishlist.`,"success")):o.removed&&(this.setIconClasses(n,["far","fa-heart"]),s.classList.remove("remove-wishlist-btn"),s.classList.add("add-to-wishlist-btn"),s.setAttribute("title","Add to wishlist"),this.showToast("Removed from Wishlist",o.message||`${a} has been removed from your wishlist.`,"info")),o.wishlist_count!==void 0&&this.updateWishlistCounter(o.wishlist_count)}else this.setIconClasses(n,r),this.showToast("Error",o.message||"An error occurred","error")}).catch(o=>{console.error("Wishlist operation failed:",o);let n=this.findHeartIcon(s);this.setIconClasses(n,r)})}updateWishlistCounter(t){try{[".wishlist-count","[data-wishlist-count]","#wishlist-count",".wishlist-counter",".nav-wishlist-count"].forEach(e=>{document.querySelectorAll(e).forEach(o=>{o.textContent=t,o.hasAttribute("data-wishlist-count")&&o.setAttribute("data-wishlist-count",t)})}),document.querySelectorAll('a[href*="wishlist"]').forEach(e=>{const r=e.textContent.trim();r.includes("(")&&r.includes(")")&&(e.textContent=r.replace(/\(\d+\)/,`(${t})`))}),console.log(`Updated wishlist counter to: ${t}`)}catch(s){console.error("Error updating wishlist counter:",s)}}findHeartIcon(t){let s=t.querySelector('i.fa-heart, i[class*="fa-heart"]');return s||(s=t.querySelector("svg")),s||(s=t.querySelector("i")),s}setIconClasses(t,s){if(t)try{["fa-heart","fas","far","fab","fal","fa-spinner","fa-spin"].forEach(e=>t.classList.remove(e)),s.forEach(e=>{e&&e.trim().length>0&&t.classList.add(e.trim())}),console.log("Icon classes updated:",{element:t.tagName,finalClasses:Array.from(t.classList)})}catch(i){console.error("Error setting icon classes:",i)}}getIconClasses(t){if(!t)return[];try{return Array.from(t.classList)}catch(s){return console.error("Error getting icon classes:",s),[]}}getCookie(t){let s=null;if(document.cookie&&document.cookie!==""){const i=document.cookie.split(";");for(let e of i)if(e=e.trim(),e.substring(0,t.length+1)===t+"="){s=decodeURIComponent(e.substring(t.length+1));break}}return s}showToast(t,s,i="info"){try{typeof Swal<"u"?Swal.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:3e3,timerProgressBar:!0,didOpen:r=>{r.addEventListener("mouseenter",Swal.stopTimer),r.addEventListener("mouseleave",Swal.resumeTimer)}}).fire({icon:i,title:t,text:s}):console.log(`${i.toUpperCase()}: ${t} - ${s}`)}catch(e){console.error("Error showing toast notification:",e),console.log(`${i.toUpperCase()}: ${t} - ${s}`)}}replaceFontAwesomeIcon(t,s){try{if(!t.parentNode){console.warn("SVG icon is no longer in the DOM, skipping replacement");return}if(!t.closest("button, a")){console.warn("Could not find parent button for SVG icon");return}const e=document.createElement("i");return s.forEach(r=>{r&&r.trim().length>0&&e.classList.add(r.trim())}),t.dataset&&Object.keys(t.dataset).forEach(r=>{e.dataset[r]=t.dataset[r]}),t.parentNode.replaceChild(e,t),requestAnimationFrame(()=>{setTimeout(()=>{dom.i2svg({node:e}),setTimeout(()=>{e&&e.tagName==="I"&&!e.hasAttribute("data-fa-i2svg")&&(console.log("FontAwesome icon not converted, retrying..."),dom.i2svg({node:e}))},100)},50)}),console.log("Replaced SVG icon with new i element:",{newClasses:s,newElement:e}),e}catch(i){return console.error("Error replacing Font Awesome SVG icon:",i),null}}positionWishlistButtons(){try{document.querySelectorAll(".product-card").forEach(s=>{const i=s.querySelector(".product-badges"),e=s.querySelector(".add-to-wishlist-btn");i&&e&&(i.querySelectorAll(".badge").length>0?(e.style.top="auto",e.style.bottom="10px",e.style.right="10px"):(e.style.top="10px",e.style.bottom="auto",e.style.right="10px"))})}catch(t){console.error("Error positioning wishlist buttons:",t)}}}export{c as W};
