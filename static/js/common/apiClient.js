import{g,m as p}from"../chunks/ajax_helper.EulIYOr7.js";import"../chunks/chunks/vendor/common.Dz0GDR6V.js";class b{constructor(e={}){this.errorHandler=e.errorHandler||console.error,this.baseUrl=e.baseUrl||"",this.csrfToken=g("csrftoken"),this.pendingRequests=[]}buildUrl(e){return e.startsWith("http")||e.startsWith("/")?e:`${this.baseUrl}/${e}`.replace(/([^:]\/)\/+/g,"$1")}get(e,s={},r={}){return this.request("GET",e,s,r)}post(e,s={},r={}){return this.request("POST",e,s,r)}delete(e,s={},r={}){return this.request("DELETE",e,s,r)}request(e,s,r={},i={}){const h=this.buildUrl(s),n=i.abortable!==!1,u=!(r instanceof FormData),m=u?"application/x-www-form-urlencoded; charset=UTF-8":!1;return new Promise((d,o)=>{try{const t=p(h,e,r,a=>{this.removePendingRequest(t),d(a)},(a,x,f)=>{var c;this.removePendingRequest(t);const l={status:a.status,statusText:a.statusText,responseJSON:a.responseJSON,message:((c=a.responseJSON)==null?void 0:c.error)||f||"Request failed"};this.errorHandler&&!i.skipGlobalErrorHandler&&this.errorHandler(l),o(l)},n,u,m);n&&t&&this.pendingRequests.push(t),i.timeout&&setTimeout(()=>{t&&t.readyState<4&&(t.abort(),o({message:"Request timed out",status:0,statusText:"timeout"}))},i.timeout)}catch(t){console.error("Error making request:",t),o({message:t.message||"Failed to make request",error:t})}})}removePendingRequest(e){const s=this.pendingRequests.indexOf(e);s!==-1&&this.pendingRequests.splice(s,1)}abortAll(){this.pendingRequests.forEach(e=>{e&&typeof e.abort=="function"&&e.abort()}),this.pendingRequests=[]}}const k=new b;export{b as A,k as a};
