/* empty css                     */import{$ as a}from"./vendor-common.B4uieipM.js";class c{constructor(){try{this.initializeProductGridFeatures(),this.filterContainer=document.getElementById("dynamic-filter-container"),this.filterContainer||console.warn("Product List Manager: dynamic-filter-container not found in the DOM"),this.filterContainer&&(this.productListUrl=this.filterContainer.dataset.productListUrl,this.productListUrl||(console.warn("Product List Manager: No product list URL provided in data-product-list-url attribute"),this.productListUrl=window.location.href),this.filterState={search:(this.filterContainer.dataset.searchQuery||"").trim(),category:(this.filterContainer.dataset.currentCategory||"").trim(),sort:"name-asc"},this.initializeFilterDomReferences(),this.hasEssentialFilterElements()&&(this.initializeFilterControls(),this.bindFilterEvents(),this.updateFilterUI(),setTimeout(()=>{this.fetchProducts()},100)))}catch(t){console.error("Error initializing Product List Manager:",t)}}initializeProductGridFeatures(){try{this.positionWishlistButtons(),document.addEventListener("click",t=>{const e=t.target.closest(".add-to-wishlist-btn");e&&this.handleWishlistButtonClick(t,e)}),window.addEventListener("resize",()=>{this.positionWishlistButtons()}),document.addEventListener("productsLoaded",()=>{this.positionWishlistButtons()})}catch(t){console.error("Error initializing product grid features:",t)}}initializeFilterDomReferences(){this.productGridContainer=document.getElementById("product-grid-container"),this.searchInput=document.querySelector(".filter-search"),this.sortSelect=document.querySelector(".filter-sort"),this.categorySelect=document.querySelector(".filter-category"),this.clearSearchBtn=document.querySelector(".clear-search"),this.resetAllBtn=document.querySelector(".reset-all-filters"),this.filterToggleBtn=document.querySelector(".filter-toggle"),this.filterOptions=document.getElementById("filterOptions"),this.searchDisplay=document.querySelector(".search-display"),this.searchTerm=document.querySelector(".search-term"),this.searchTermSummary=document.querySelector(".search-term-summary"),this.searchSummary=document.querySelector(".search-summary"),this.categoriesDisplay=document.querySelector(".categories-display"),this.categoryCountDisplay=document.querySelector(".category-count-display"),this.categoriesSummary=document.querySelector(".categories-summary"),this.categoryCountSummary=document.querySelector(".category-count-summary"),this.categoryTagsContainer=document.getElementById("selectedCategoriesTags"),this.clearCategoriesBtn=document.querySelector(".clear-categories-btn"),this.itemCountDisplay=document.querySelector(".item-count"),this.productCountDisplay=document.getElementById("product-count")}hasEssentialFilterElements(){return this.productGridContainer?!0:(console.warn("Product List Manager: product-grid-container not found in the DOM"),!1)}initializeFilterControls(){try{const e=new URLSearchParams(window.location.search).get("sort");if(this.sortSelect&&e&&(this.sortSelect.value=e,this.filterState.sort=e),this.categorySelect&&typeof a<"u"&&a.fn&&typeof a.fn.select2<"u")try{a(this.categorySelect).select2({placeholder:"Select Categories",allowClear:!0,width:"100%"})}catch(i){console.warn("Error initializing Select2:",i)}}catch(t){console.error("Error initializing controls:",t)}}bindFilterEvents(){try{this.searchInput&&this.searchInput.addEventListener("input",this.handleSearchInput.bind(this)),this.sortSelect&&this.sortSelect.addEventListener("change",this.handleSortChange.bind(this)),this.categorySelect&&this.categorySelect.addEventListener("change",this.handleCategoryChange.bind(this)),this.clearSearchBtn&&this.clearSearchBtn.addEventListener("click",this.handleClearSearch.bind(this)),this.clearCategoriesBtn&&this.clearCategoriesBtn.addEventListener("click",this.handleClearCategories.bind(this)),this.resetAllBtn&&this.resetAllBtn.addEventListener("click",this.handleResetAll.bind(this)),this.filterToggleBtn&&this.filterToggleBtn.addEventListener("click",this.handleFilterToggle.bind(this)),document.addEventListener("click",t=>{try{if(t.target.closest(".search-summary .btn-close")&&this.handleClearSearch(),t.target.closest(".categories-summary .btn-close")&&this.handleClearCategories(),t.target.closest(".tag-remove")){const e=t.target.closest(".tag-remove").dataset.categoryId;e&&this.removeCategoryById(e)}}catch(e){console.error("Error handling click event:",e)}})}catch(t){console.error("Error binding events:",t)}}handleSearchInput(t){try{this.filterState.search=t.target.value,this.updateFilterUI(),clearTimeout(this.searchTimer),this.searchTimer=setTimeout(()=>{this.fetchProducts()},300)}catch(e){console.error("Error handling search input:",e)}}handleSortChange(t){try{this.filterState.sort=t.target.value,this.updateFilterUI(),this.fetchProducts()}catch(e){console.error("Error handling sort change:",e)}}handleCategoryChange(t){try{let e=[];t.target.selectedOptions?e=Array.from(t.target.selectedOptions).map(i=>i.value):t.target.options&&t.target.multiple?e=Array.from(t.target.options).filter(i=>i.selected).map(i=>i.value):t.target.value&&(e=[t.target.value]),this.filterState.category=e.join(","),this.updateFilterUI(),this.fetchProducts()}catch(e){console.error("Error handling category change:",e)}}handleClearSearch(){try{this.filterState.search="",this.searchInput&&(this.searchInput.value=""),this.updateFilterUI(),this.fetchProducts()}catch(t){console.error("Error clearing search:",t)}}handleClearCategories(){try{if(this.filterState.category="",this.categorySelect)if(typeof a<"u"&&a.fn&&typeof a.fn.select2<"u")try{a(this.categorySelect).val(null).trigger("change")}catch(t){console.warn("Error with Select2 clearing:",t),Array.from(this.categorySelect.options).forEach(e=>e.selected=!1)}else Array.from(this.categorySelect.options).forEach(t=>t.selected=!1);this.updateFilterUI(),this.fetchProducts()}catch(t){console.error("Error clearing categories:",t)}}handleResetAll(){try{if(this.filterState={search:"",category:"",sort:"name-asc"},this.searchInput&&(this.searchInput.value=""),this.sortSelect&&(this.sortSelect.value="name-asc"),this.categorySelect)if(typeof a<"u"&&a.fn&&typeof a.fn.select2<"u")try{a(this.categorySelect).val(null).trigger("change")}catch(t){console.warn("Error with Select2 resetting:",t),Array.from(this.categorySelect.options).forEach(e=>e.selected=!1)}else Array.from(this.categorySelect.options).forEach(t=>t.selected=!1);this.updateFilterUI(),this.fetchProducts()}catch(t){console.error("Error resetting filters:",t)}}handleFilterToggle(){try{if(!this.filterOptions)return;const t=this.filterOptions.classList.contains("show");if(this.filterOptions.classList.toggle("show"),this.filterToggleBtn){this.filterToggleBtn.classList.toggle("collapsed",!t),this.filterToggleBtn.setAttribute("aria-expanded",t?"false":"true");const e=this.filterToggleBtn.querySelector(".filter-toggle-text");e&&(e.textContent=t?"Show Filters":"Hide Filters")}}catch(t){console.error("Error toggling filter visibility:",t)}}removeCategoryById(t){try{if(!t)return;const i=this.filterState.category.split(",").filter(r=>r).filter(r=>r!==t);if(this.filterState.category=i.join(","),this.categorySelect)if(typeof a<"u"&&a.fn&&typeof a.fn.select2<"u")try{a(this.categorySelect).val(i).trigger("change")}catch(r){console.warn("Error with Select2 category removal:",r),Array.from(this.categorySelect.options).forEach(s=>{s.selected=i.includes(s.value)})}else Array.from(this.categorySelect.options).forEach(r=>{r.selected=i.includes(r.value)});this.updateUI(),this.fetchProducts()}catch(e){console.error("Error removing category:",e)}}updateFilterUI(){try{this.searchTerm&&(this.searchTerm.textContent=this.filterState.search),this.searchTermSummary&&(this.searchTermSummary.textContent=this.filterState.search),this.searchDisplay&&this.searchDisplay.classList.toggle("d-none",!this.filterState.search),this.searchSummary&&this.searchSummary.classList.toggle("d-none",!this.filterState.search);const e=(this.filterState.category?this.filterState.category.split(",").filter(i=>i):[]).length;this.categoryCountDisplay&&(this.categoryCountDisplay.textContent=e),this.categoryCountSummary&&(this.categoryCountSummary.textContent=e),this.categoriesDisplay&&this.categoriesDisplay.classList.toggle("d-none",e===0),this.categoriesSummary&&this.categoriesSummary.classList.toggle("d-none",e===0),this.updateCategoryTags()}catch(t){console.error("Error updating UI:",t)}}updateCategoryTags(){try{if(!this.categoryTagsContainer||!this.categorySelect||(this.categoryTagsContainer.innerHTML="",!this.filterState.category))return;const t=this.filterState.category.split(",").filter(e=>e);if(t.length===0)return;t.forEach(e=>{try{const i=Array.from(this.categorySelect.options).find(o=>o.value===e);if(!i)return;const r=i.textContent.trim(),s=document.createElement("div");s.className="category-tag",s.innerHTML=`
                        <span class="tag-text">${r}</span>
                        <button type="button" class="tag-remove" data-category-id="${e}">
                            <i class="fas fa-times"></i>
                        </button>
                    `,this.categoryTagsContainer.appendChild(s)}catch(i){console.warn(`Error creating tag for category ID ${e}:`,i)}})}catch(t){console.error("Error updating category tags:",t)}}isValidUrl(t){try{return new URL(t),!0}catch{return!1}}getBaseUrl(){return this.productListUrl&&this.isValidUrl(this.productListUrl)?this.productListUrl:this.productListUrl&&this.productListUrl.startsWith("/")?new URL(this.productListUrl,window.location.origin).href:window.location.href}fetchProducts(){this.productGridContainer&&(this.productGridContainer.classList.add("loading"),this.originalGridHtml=this.productGridContainer.innerHTML);try{const t=this.getBaseUrl(),e=new URL(t);this.filterState.search&&e.searchParams.set("search",this.filterState.search),this.filterState.category&&e.searchParams.set("category",this.filterState.category),this.filterState.sort&&e.searchParams.set("sort",this.filterState.sort),e.searchParams.set("_",Date.now());const i=new AbortController,r=setTimeout(()=>i.abort(),15e3);fetch(e,{method:"GET",headers:{"X-Requested-With":"XMLHttpRequest",Accept:"application/json"},signal:i.signal}).then(s=>{if(clearTimeout(r),!s.ok)throw new Error(`Server returned ${s.status}: ${s.statusText}`);const o=s.headers.get("content-type");if(!o||!o.includes("application/json"))throw new Error("Response was not JSON. Received: "+o);return s.json()}).then(s=>{this.productGridContainer&&(s.html?this.productGridContainer.innerHTML=s.html:this.productGridContainer.innerHTML='<div class="alert alert-info">No products found matching your criteria.</div>');const o=s.count||0;this.itemCountDisplay&&(this.itemCountDisplay.textContent=o),this.productCountDisplay&&(this.productCountDisplay.textContent=o),document.dispatchEvent(new CustomEvent("productsLoaded",{detail:s})),this.positionWishlistButtons()}).catch(s=>{console.error("Error fetching products:",s);let o="Error loading products. ";s.name==="AbortError"?o+="Request timed out. Please check your internet connection and try again.":s.message.includes("JSON")?o+="Unexpected response format from server.":o+="Please try again or contact support if the issue persists.",this.productGridContainer&&(this.productGridContainer.innerHTML=`<div class="alert alert-danger">${o}</div>`)}).finally(()=>{this.productGridContainer&&this.productGridContainer.classList.remove("loading")})}catch(t){console.error("Error constructing request:",t),this.productGridContainer&&(this.productGridContainer.classList.remove("loading"),this.productGridContainer.innerHTML=`<div class="alert alert-danger">Configuration error: ${t.message}</div>`)}}handleWishlistButtonClick(t,e){t.preventDefault(),e.dataset.productId;const i=e.getAttribute("href"),r=e.querySelector("i"),s=r.className;r.className="fas fa-spinner fa-spin",fetch(i,{method:"POST",headers:{"X-CSRFToken":this.getCookie("csrftoken"),"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"},credentials:"same-origin"}).then(o=>{if(!o.ok)throw new Error(`Server returned ${o.status}: ${o.statusText}`);return o.json()}).then(o=>{o.success?o.added?(r.className="fas fa-heart",e.classList.add("active")):(r.className="far fa-heart",e.classList.remove("active")):(r.className=s,console.error("Error updating wishlist:",o.message||"Unknown error"))}).catch(o=>{console.error("Error updating wishlist:",o),r.className=s})}positionWishlistButtons(){try{document.querySelectorAll(".product-card").forEach(e=>{const i=e.querySelector(".product-badges"),r=e.querySelector(".add-to-wishlist-btn");i&&r&&(i.querySelectorAll(".badge").length>0?(r.style.top="auto",r.style.bottom="10px",r.style.right="10px"):(r.style.top="10px",r.style.bottom="auto",r.style.right="10px"))})}catch(t){console.error("Error positioning wishlist buttons:",t)}}getCookie(t){let e=null;if(document.cookie&&document.cookie!==""){const i=document.cookie.split(";");for(let r=0;r<i.length;r++){const s=i[r].trim();if(s.substring(0,t.length+1)===t+"="){e=decodeURIComponent(s.substring(t.length+1));break}}}return e}}document.addEventListener("DOMContentLoaded",function(){try{window.productListManager=new c}catch(n){console.error("Fatal error initializing Product List Manager:",n);const t=document.getElementById("product-grid-container");t&&(t.innerHTML='<div class="alert alert-danger">There was an error initializing the product list. Please refresh the page or contact support.</div>')}});
