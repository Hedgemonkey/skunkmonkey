import{a as s}from"./vendor-common.B4uieipM.js";import"./vendor-bootstrap.FSX3skFY.js";console.log("Image Cropper module loading...");const r={initialized:!1,cropperInstance:null,elements:{},init:function(e){this.initialized&&(console.log("ImageCropper already initialized, cleaning up first"),this.cleanUp()),console.log("ImageCropper.init() called with options:",e);const t={...{cropperOptions:{aspectRatio:1,viewMode:1,autoCropArea:.8,responsive:!0,restore:!1,guides:!0,center:!0,highlight:!1,cropBoxMovable:!0,cropBoxResizable:!0,toggleDragModeOnDblclick:!1}},...e};if(this.config=t,this.elements.fileInput=document.querySelector(t.fileInputSelector),this.elements.cropperModal=document.querySelector(t.modalSelector),this.elements.cropperImage=document.querySelector(t.cropperImageSelector),this.elements.cropButton=document.querySelector(t.cropButtonSelector),this.elements.previewImage=t.previewSelector?document.querySelector(t.previewSelector):null,this.elements.previewContainer=t.previewContainerSelector?document.querySelector(t.previewContainerSelector):null,this.elements.croppedImageData=document.querySelector(t.croppedDataInputSelector),console.log("Elements found:",{fileInput:this.elements.fileInput?"Yes":"No",cropperModal:this.elements.cropperModal?"Yes":"No",cropperImage:this.elements.cropperImage?"Yes":"No",cropButton:this.elements.cropButton?"Yes":"No",previewImage:this.elements.previewImage?"Yes":"No",previewContainer:this.elements.previewContainer?"Yes":"No",croppedImageData:this.elements.croppedImageData?"Yes":"No"}),this.elements.fileInput?console.log(`File input found with ID: ${this.elements.fileInput.id}`):(console.warn(`File input not found with selector: ${t.fileInputSelector}`),console.log("Available file inputs:",Array.from(document.querySelectorAll('input[type="file"]')).map(o=>o.id||"no-id"))),this.elements.zoomInButton=document.querySelector("#zoom-in"),this.elements.zoomOutButton=document.querySelector("#zoom-out"),this.elements.moveLeftButton=document.querySelector("#move-left"),this.elements.moveRightButton=document.querySelector("#move-right"),this.elements.moveUpButton=document.querySelector("#move-up"),this.elements.moveDownButton=document.querySelector("#move-down"),this.elements.rotateLeftButton=document.querySelector("#rotate-left"),this.elements.rotateRightButton=document.querySelector("#rotate-right"),this.elements.rotateSlider=document.querySelector("#rotate-slider"),!this.elements.fileInput||!this.elements.cropperModal||!this.elements.cropperImage||!this.elements.cropButton||!this.elements.croppedImageData){console.error("Missing required elements. Cropper initialization aborted.");const o=[];this.elements.fileInput||o.push(`fileInput (${t.fileInputSelector})`),this.elements.cropperModal||o.push(`cropperModal (${t.modalSelector})`),this.elements.cropperImage||o.push(`cropperImage (${t.cropperImageSelector})`),this.elements.cropButton||o.push(`cropButton (${t.cropButtonSelector})`),this.elements.croppedImageData||o.push(`croppedImageData (${t.croppedDataInputSelector})`),console.error("Missing elements:",o.join(", "));return}this.bsModal=null,typeof bootstrap<"u"&&bootstrap.Modal?(this.bsModal=new bootstrap.Modal(this.elements.cropperModal),console.log("Bootstrap Modal created")):console.log("Bootstrap Modal not available, will use jQuery fallback"),this.setupEventListeners(),this.initialized=!0,console.log("Image cropper setup complete")},setupEventListeners:function(){this.removeEventListeners(),this.fileChangeHandler=this.handleFileInputChange.bind(this),this.elements.fileInput.addEventListener("change",this.fileChangeHandler),this.cropButtonHandler=this.handleCropButtonClick.bind(this),this.elements.cropButton.addEventListener("click",this.cropButtonHandler),this.modalHiddenHandler=this.handleModalHidden.bind(this),this.elements.cropperModal.addEventListener("hidden.bs.modal",this.modalHiddenHandler),this.setupControlEvents();const e=this.elements.cropperModal.querySelectorAll('[data-bs-dismiss="modal"]');e.length&&e.forEach(n=>{this.closeButtonHandler=this.handleModalClose.bind(this),n.addEventListener("click",this.closeButtonHandler)})},removeEventListeners:function(){this.elements.fileInput&&this.fileChangeHandler&&(this.elements.fileInput.removeEventListener("change",this.fileChangeHandler),this.fileChangeHandler=null),this.elements.cropButton&&this.cropButtonHandler&&(this.elements.cropButton.removeEventListener("click",this.cropButtonHandler),this.cropButtonHandler=null),this.elements.cropperModal&&this.modalHiddenHandler&&(this.elements.cropperModal.removeEventListener("hidden.bs.modal",this.modalHiddenHandler),this.modalHiddenHandler=null),this.cleanUpControlEvents()},handleFileInputChange:function(e){console.log("File input change event triggered"),e.target.files&&e.target.files.length?(console.log(`Selected file: ${e.target.files[0].name}`),this.processFile(e.target.files[0])):console.warn("No file selected or change event fired without files")},processFile:function(e){if(!e)return;if(console.log("Processing file:",e.name),!e.type.match("image.*")){alert("Please select an image file");return}this.destroyCropper();const n=URL.createObjectURL(e);if(this.elements.cropperImage.src=n,this.bsModal)console.log("Using Bootstrap 5 Modal API"),this.bsModal.show();else if(typeof bootstrap<"u"&&bootstrap.Modal)console.log("Creating new Bootstrap 5 Modal instance"),this.bsModal=new bootstrap.Modal(this.elements.cropperModal),this.bsModal.show();else{console.log("Fallback: Manual modal display"),this.elements.cropperModal.style.display="block",this.elements.cropperModal.classList.add("show"),document.body.classList.add("modal-open");let t=document.querySelector(".modal-backdrop");t||(t=document.createElement("div"),t.classList.add("modal-backdrop","fade","show"),document.body.appendChild(t))}setTimeout(()=>{this.initializeCropper()},300)},initializeCropper:function(){this.destroyCropper();try{this.cropperInstance=new s(this.elements.cropperImage,this.config.cropperOptions),console.log("Cropper initialized successfully")}catch(e){console.error("Error initializing cropper:",e)}},destroyCropper:function(){if(this.cropperInstance)try{this.cropperInstance.destroy(),this.cropperInstance=null,console.log("Cropper instance destroyed")}catch(e){console.error("Error destroying cropper:",e)}},handleCropButtonClick:function(){if(!this.cropperInstance){console.error("No cropper instance found");return}try{this.cropperInstance.getCroppedCanvas({width:300,height:300,minWidth:100,minHeight:100,maxWidth:4096,maxHeight:4096,fillColor:"#fff",imageSmoothingEnabled:!0,imageSmoothingQuality:"high"}).toBlob(n=>{const t=new FileReader;t.readAsDataURL(n),t.onloadend=()=>{const o=t.result;this.elements.croppedImageData.value=o,console.log("Cropped image data stored"),this.elements.previewImage&&this.elements.previewContainer&&(this.elements.previewImage.src=o,this.elements.previewContainer.classList.remove("d-none"),console.log("Preview updated")),this.hideModal(),URL.revokeObjectURL(this.elements.cropperImage.src)}},"image/jpeg",.9)}catch(e){console.error("Error cropping image:",e)}},hideModal:function(){if(this.bsModal)console.log("Using existing Bootstrap 5 Modal instance to hide"),this.bsModal.hide();else if(typeof bootstrap<"u"&&bootstrap.Modal)console.log("Creating temporary Bootstrap 5 Modal instance to hide"),(bootstrap.Modal.getInstance(this.elements.cropperModal)||new bootstrap.Modal(this.elements.cropperModal)).hide();else{console.log("Fallback: Manual modal hide"),this.elements.cropperModal.style.display="none",this.elements.cropperModal.classList.remove("show"),document.body.classList.remove("modal-open");const e=document.querySelector(".modal-backdrop");e&&e.parentNode.removeChild(e)}},handleModalClose:function(){this.hideModal()},handleModalHidden:function(){this.elements.croppedImageData&&!this.elements.croppedImageData.value&&(this.elements.fileInput.value=""),this.destroyCropper()},setupControlEvents:function(){this.setupButtonControl(this.elements.zoomInButton,()=>{this.cropperInstance&&this.cropperInstance.zoom(.1)}),this.setupButtonControl(this.elements.zoomOutButton,()=>{this.cropperInstance&&this.cropperInstance.zoom(-.1)}),this.setupButtonControl(this.elements.moveLeftButton,()=>{this.cropperInstance&&this.cropperInstance.move(-10,0)}),this.setupButtonControl(this.elements.moveRightButton,()=>{this.cropperInstance&&this.cropperInstance.move(10,0)}),this.setupButtonControl(this.elements.moveUpButton,()=>{this.cropperInstance&&this.cropperInstance.move(0,-10)}),this.setupButtonControl(this.elements.moveDownButton,()=>{this.cropperInstance&&this.cropperInstance.move(0,10)}),this.setupButtonControl(this.elements.rotateLeftButton,()=>{this.cropperInstance&&(this.cropperInstance.rotate(-45),this.elements.rotateSlider&&(this.elements.rotateSlider.value=this.cropperInstance.getData().rotate))}),this.setupButtonControl(this.elements.rotateRightButton,()=>{this.cropperInstance&&(this.cropperInstance.rotate(45),this.elements.rotateSlider&&(this.elements.rotateSlider.value=this.cropperInstance.getData().rotate))}),this.elements.rotateSlider&&(this.rotateSliderHandler=e=>{if(this.cropperInstance){const n=parseInt(e.target.value,10);this.cropperInstance.rotateTo(n)}},this.elements.rotateSlider.addEventListener("input",this.rotateSliderHandler))},setupButtonControl:function(e,n){if(!e)return;const t=()=>{n()};e._cropperHandler=t,e.addEventListener("click",t)},cleanUpControlEvents:function(){this.cleanupButtonControl(this.elements.zoomInButton),this.cleanupButtonControl(this.elements.zoomOutButton),this.cleanupButtonControl(this.elements.moveLeftButton),this.cleanupButtonControl(this.elements.moveRightButton),this.cleanupButtonControl(this.elements.moveUpButton),this.cleanupButtonControl(this.elements.moveDownButton),this.cleanupButtonControl(this.elements.rotateLeftButton),this.cleanupButtonControl(this.elements.rotateRightButton),this.elements.rotateSlider&&this.rotateSliderHandler&&(this.elements.rotateSlider.removeEventListener("input",this.rotateSliderHandler),this.rotateSliderHandler=null)},cleanupButtonControl:function(e){!e||!e._cropperHandler||(e.removeEventListener("click",e._cropperHandler),e._cropperHandler=null)},cleanUp:function(){console.log("Cleaning up ImageCropper resources"),this.destroyCropper(),this.removeEventListeners(),this.initialized=!1}};(function(e){e.Cropper=s,console.log("Cropper library explicitly exposed to global scope"),e.ImageCropper=r,console.log("ImageCropper explicitly exposed to global scope")})(typeof window<"u"?window:void 0);export{r as I};
